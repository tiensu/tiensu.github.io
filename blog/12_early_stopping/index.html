<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>SuNT&#39;s Blog | AI in Practical</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="SuNT">
  <meta name="generator" content="Hugo 0.68.3" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/venobox/venobox.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/css/override.css">
  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://tiensu.github.io/"><img class="img-fluid"
          src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/tiensunguyen2103"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://tiensu.github.io/"><img class="img-fluid"
            src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/contact">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://tiensu.github.io//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/machine-learning"
          class="text-primary">Machine Learning</a>
        
        <a href="/categories/xgboost"
          class="text-primary">X g boost</a>
        
        <h2>XGBoost - Bài 9: Cấu hình Early_Stopping cho XGBoost model</h2>
        <div class="mb-3 post-meta">
          <span>By SuNT</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>30 September 2020</span>
          
        </div>
        
        <img src="https://tiensu.github.io/images/featured-post/xgboost_early_stopping.png" class="img-fluid w-100 mb-4" alt="XGBoost - Bài 9: Cấu hình Early_Stopping cho XGBoost model">
        
        <div class="content mb-5">
          <p><a href="https://en.wikipedia.org/wiki/Overfitting">Overfitting</a> vẫn luôn là một vấn đề làm đau đầu những kỹ sư AI. Trong bài viết này chúng ta sẽ cùng tìm hiểu cách thức monitor (<em>giám sát</em>) performance (<em>hiệu năng</em>) của XGBoost model trong suốt quá trình train. Từ đó cấu hình <code>early stopping</code> để  quyết định khi nào thì nên dừng lại quá trình này để tránh hiện tượng <code>overfitting</code>.
Bài viết gồm 2 phần:</p>
<ul>
<li>Monitor hiệu năng của XGBoost model thông qua <code>learning curve</code> (<em>đường cong học tập</em>).</li>
<li>Cấu hình <code>early stopping</code>.</li>
</ul>
<p><strong>1. Giám sát hiệu năng của XGBoost model</strong></p>
<p>Để  monitor porformance của XGBoost model, ta cần cung cấp cả <code>train set</code>, <code>test set</code> và một metric (<em>chỉ tiêu đánh giá</em>) khi train model (<em>gọi hàm <code>model.fit()</code></em>). Ví dụ, để tính toán <code>error</code> metric trên tập <code>test set</code>, sử dụng code snippet sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">eval_set <span style="color:#f92672">=</span> [(X_test, y_test)]
model<span style="color:#f92672">.</span>fit(X_train, y_train, eval_metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;error&#34;</span>, eval_set<span style="color:#f92672">=</span>eval_set, verbose<span style="color:#f92672">=</span>True)
</code></pre></div><p>XGBoost model hỗ trợ một số metric như sau:</p>
<ul>
<li><strong>rmse</strong>: root mean squared error.</li>
<li><strong>mae</strong>: mean absolute error.</li>
<li><strong>logloss</strong>: binary logarithmic loss.</li>
<li><strong>mlogloss</strong>: multiclass log loss (cross entropy).</li>
<li><strong>error</strong>: classification error.</li>
<li><strong>auc</strong>: area under ROC curve.
Danh sách đầy đủ các metrics, các bạn có thể xem tại <a href="http://XGBoost.readthedocs.io/en/latest/parameter.html">đây</a>.</li>
</ul>
<p>Code dưới đây minh hoạ việc monitor performance trong quá trình train một XGBoost model trên tập dữ liệu <a href="https://archive.ics.uci.edu/ml/datasets/Pima+Indians+Diabet">Pima Indians onset of diabetes</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># monitor training performance</span>
<span style="color:#f92672">from</span> numpy <span style="color:#f92672">import</span> loadtxt
<span style="color:#f92672">from</span> XGBoost <span style="color:#f92672">import</span> XGBClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score
<span style="color:#75715e"># load data</span>
dataset <span style="color:#f92672">=</span> loadtxt(<span style="color:#e6db74">&#39;pima-indians-diabetes.csv&#39;</span>, delimiter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;,&#34;</span>)
<span style="color:#75715e"># split data into X and y</span>
X <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">8</span>]
Y <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">8</span>]
<span style="color:#75715e"># split data into train and test sets</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, Y, test_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.33</span>, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>)
<span style="color:#75715e"># fit model on training data</span>
model <span style="color:#f92672">=</span> XGBClassifier()
eval_set <span style="color:#f92672">=</span> [(X_test, y_test)]
model<span style="color:#f92672">.</span>fit(X_train, y_train, eval_metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;error&#34;</span>, eval_set<span style="color:#f92672">=</span>eval_set, verbose<span style="color:#f92672">=</span>True)
<span style="color:#75715e"># make predictions for test data</span>
predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#75715e"># evaluate predictions</span>
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, predictions)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Accuracy: </span><span style="color:#e6db74">%.2f%%</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (accuracy <span style="color:#f92672">*</span> <span style="color:#ae81ff">100.0</span>))
</code></pre></div><p>Ở đây, ta sử dụng 67% dữ liệu cho việc train, 33% còn lại cho viêc đánh giá model. <code>Error</code> metric được tính toán tại cuối mỗi vòng lặp (<em>sau khi mỗi <code>boosted tree</code> được thêm vào model</em>). Cuối cùng, độ chính xác của model được in ra.</p>
<p>Kết quả hiển thị trên màn hình như sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[<span style="color:#ae81ff">0</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.28347</span>
[<span style="color:#ae81ff">1</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.25984</span>
[<span style="color:#ae81ff">2</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.25591</span>
[<span style="color:#ae81ff">3</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.24803</span>
[<span style="color:#ae81ff">4</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.24409</span>
[<span style="color:#ae81ff">5</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.24803</span>
[<span style="color:#ae81ff">6</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.25591</span>
[<span style="color:#ae81ff">7</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.24803</span>
[<span style="color:#ae81ff">8</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.25591</span>
[<span style="color:#ae81ff">9</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.24409</span>
<span style="color:#f92672">...</span>
[<span style="color:#ae81ff">89</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.26378</span>
[<span style="color:#ae81ff">90</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.27165</span>
[<span style="color:#ae81ff">91</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.26772</span>
[<span style="color:#ae81ff">92</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.27165</span>
[<span style="color:#ae81ff">93</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.26378</span>
[<span style="color:#ae81ff">94</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.27165</span>
[<span style="color:#ae81ff">95</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.26378</span>
[<span style="color:#ae81ff">96</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.25984</span>
[<span style="color:#ae81ff">97</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.26378</span>
[<span style="color:#ae81ff">98</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.25984</span>
[<span style="color:#ae81ff">99</span>]	validation_0<span style="color:#f92672">-</span>error:<span style="color:#ae81ff">0.25984</span>
Accuracy: <span style="color:#ae81ff">74.02</span><span style="color:#f92672">%</span>
</code></pre></div><p>Quan sát kết quả ta thấy performance của model không thay dổi quá nhiều trong suốt quá trình train. Thậm chí đến cuối quá trình, performance còn kém hơn so với nửa đầu.</p>
<p>Để có cái nhìn tường minh hơn, hãy thể hiện performance của model trên đồ thị.
Ta sẽ monitor performace của model trên cả <code>train set</code> và <code>test set</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">eval_set <span style="color:#f92672">=</span> [(X_train, y_train), (X_test, y_test)]
model<span style="color:#f92672">.</span>fit(X_train, y_train, eval_metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;error&#34;</span>, eval_set<span style="color:#f92672">=</span>eval_set, verbose<span style="color:#f92672">=</span>True)
</code></pre></div><p>Performance của model trên mỗi tập <code>evaluation set</code> được lưu bởi model sau khi train kết thúc. Để truy cập giá trị performace này, sử dụng hàm <code>model.evals_result()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>evals_result()
<span style="color:#66d9ef">print</span>(results)
</code></pre></div><p>Kết quả in ra sẽ giống như sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">{
<span style="color:#e6db74">&#39;validation_0&#39;</span>: {<span style="color:#e6db74">&#39;error&#39;</span>: [<span style="color:#ae81ff">0.259843</span>, <span style="color:#ae81ff">0.26378</span>, <span style="color:#ae81ff">0.26378</span>, <span style="color:#f92672">...</span>]},
<span style="color:#e6db74">&#39;validation_1&#39;</span>: {<span style="color:#e6db74">&#39;error&#39;</span>: [<span style="color:#ae81ff">0.22179</span>, <span style="color:#ae81ff">0.202335</span>, <span style="color:#ae81ff">0.196498</span>, <span style="color:#f92672">...</span>]}
}
</code></pre></div><p><code>validation_0</code> và <code>validation_1</code> theo thứ tự tương ứng với hai tập <code>validation set</code> mà ta đã định nghĩa trong tham số <code>eval_set</code> khi gọi hàm <code>fit()</code>.</p>
<p><code>Error</code> metric được truy cập như sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results[<span style="color:#e6db74">&#39;validation_0&#39;</span>][<span style="color:#e6db74">&#39;error&#39;</span>]
results[<span style="color:#e6db74">&#39;validation_1&#39;</span>][<span style="color:#e6db74">&#39;error&#39;</span>]
</code></pre></div><p>Thêm nữa, bạn có thể lựa chọn nhiều metrics để đánh giá model bằng cách cung cấp một mảng các giá trị metric tới tham số <code>eval_metric</code> của hàm <code>fit()</code>. Giá trị của các metric thu được sau đó đươc thể hiện trên đồ thị, gọi là <code>learning curve</code>.</p>
<p>Code đầy đủ dưới đây minh họa việc thu thập giá tị của các metrics và thể hiện trên <code>learning curve</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># plot learning curve</span>
<span style="color:#f92672">from</span> numpy <span style="color:#f92672">import</span> loadtxt
<span style="color:#f92672">from</span> XGBoost <span style="color:#f92672">import</span> XGBClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score
<span style="color:#f92672">from</span> matplotlib <span style="color:#f92672">import</span> pyplot
<span style="color:#75715e"># load data</span>
dataset <span style="color:#f92672">=</span> loadtxt(<span style="color:#e6db74">&#39;pima-indians-diabetes.csv&#39;</span>, delimiter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;,&#34;</span>)
<span style="color:#75715e"># split data into X and y</span>
X <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">8</span>]
Y <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">8</span>]
<span style="color:#75715e"># split data into train and test sets</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, Y, test_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.33</span>, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>)
<span style="color:#75715e"># fit model on training data</span>
model <span style="color:#f92672">=</span> XGBClassifier()
eval_set <span style="color:#f92672">=</span> [(X_train, y_train), (X_test, y_test)]
model<span style="color:#f92672">.</span>fit(X_train, y_train, eval_metric<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;error&#34;</span>, <span style="color:#e6db74">&#34;logloss&#34;</span>], eval_set<span style="color:#f92672">=</span>eval_set,
verbose<span style="color:#f92672">=</span>True)
<span style="color:#75715e"># make predictions for test data</span>
predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#75715e"># evaluate predictions</span>
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, predictions)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Accuracy: </span><span style="color:#e6db74">%.2f%%</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (accuracy <span style="color:#f92672">*</span> <span style="color:#ae81ff">100.0</span>))
<span style="color:#75715e"># retrieve performance metrics</span>
results <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>evals_result()
epochs <span style="color:#f92672">=</span> len(results[<span style="color:#e6db74">&#39;validation_0&#39;</span>][<span style="color:#e6db74">&#39;error&#39;</span>])
x_axis <span style="color:#f92672">=</span> range(<span style="color:#ae81ff">0</span>, epochs)
<span style="color:#75715e"># plot log loss</span>
fig, ax <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>subplots()
ax<span style="color:#f92672">.</span>plot(x_axis, results[<span style="color:#e6db74">&#39;validation_0&#39;</span>][<span style="color:#e6db74">&#39;logloss&#39;</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Train&#39;</span>)
ax<span style="color:#f92672">.</span>plot(x_axis, results[<span style="color:#e6db74">&#39;validation_1&#39;</span>][<span style="color:#e6db74">&#39;logloss&#39;</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Test&#39;</span>)
ax<span style="color:#f92672">.</span>legend()
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Log Loss&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;XGBoost Log Loss&#39;</span>)
pyplot<span style="color:#f92672">.</span>show()
<span style="color:#75715e"># plot classification error</span>
fig, ax <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>subplots()
ax<span style="color:#f92672">.</span>plot(x_axis, results[<span style="color:#e6db74">&#39;validation_0&#39;</span>][<span style="color:#e6db74">&#39;error&#39;</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Train&#39;</span>)
ax<span style="color:#f92672">.</span>plot(x_axis, results[<span style="color:#e6db74">&#39;validation_1&#39;</span>][<span style="color:#e6db74">&#39;error&#39;</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Test&#39;</span>)
ax<span style="color:#f92672">.</span>legend()
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Classification Error&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;XGBoost Classification Error&#39;</span>)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p>Chạy code trên, <code>error</code> và <code>logloss</code> metric trên cả 2 tập <code>train set</code> và <code>test set</code> được in ra. Ta có thể bỏ qua điều này bằng cách truyền giá trị <code>False</code> (<em>giá trị mặc định</em>) cho tham sô <code>verbose</code> khi gọi hàm <code>fit()</code>. Hai đồ thị được tạo ra. Đồ thị đầu tiên thể hiện <code>logloss</code> của XGBoost model đối với mỗi <code>epoch</code> (<em>iteration</em>) trong quá trình train.</p>


<div style="text-align:center">
    <img style="height:auto" src="/images/post/plot_learning_curve_1.png">
</div>


<p>Đồ thị thứ 2 hiển thị <code>error</code> metric của mỗi epoch.</p>


<div style="text-align:center">
    <img style="height:auto" src="/images/post/plot_learning_curve_2.png">
</div>


<p>Quan sát cả 2 đồ thị trên ta có một nhận xét rằng, nếu dừng train sớm hơn tại epoch &lt; 100 thì performace của model sẽ tốt hơn. Đây chính là tiền đề của kỹ thuật <code>early stopping</code> mà chúng ta sẽ tìm hiểu ngay sau đây.</p>
<p><strong>2. Cấu hình <code>early stopping</code> cho XGBoost model</strong></p>
<p><code>Early stopping</code> là một kỹ thuật khá phổ biến áp dụng cho các ML model phức tạp để tránh hiện tượng <code>overfitting</code>. Nó làm việc bằng cách monitor performance của model trên tập <code>test set</code> trong suốt quá trình train và buộc quá trình này dừng lại một khi performance của model không được cải thiện sau một số epochs nhất định.</p>
<p>Trên đồ thị <code>learning curve</code>, điểm bắt đầu <code>overfitting</code> là điể mà tại đó performace của model trên tập <code>test set</code> bắt đầu giảm trong khi performance của model trên tập <code>train set</code> vẫn tiếp tục tăng.</p>
<p>Để cấu hình <code>early stopping</code> cho XGBoost model, cần cung cấp thêm giá trị cho tham số <code>early_stopping_rounds</code> khi gọi hàm <code>fit()</code>. Ý nghĩa của nó là chỉ ra số lượng epochs mà quá trình húân luyện trải qua mà performance không có sự cải thiện nào.</p>
<p>Ví dụ:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">eval_set <span style="color:#f92672">=</span> [(X_test, y_test)]
model<span style="color:#f92672">.</span>fit(X_train, y_train, early_stopping_rounds<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, eval_metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logloss&#34;</span>, eval_set<span style="color:#f92672">=</span>eval_set, verbose<span style="color:#f92672">=</span>True)
</code></pre></div><p>Nếu có nhiều <code>evaluation sets</code> hoặc nhiều metrics được cung cấp, <code>early stopping</code> sẽ sử dụng cái cuối cùng trong danh sách.</p>
<p>Code đầy đủ cấu hình <code>early stopping</code> như bên dưới:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># early stopping</span>
<span style="color:#f92672">from</span> numpy <span style="color:#f92672">import</span> loadtxt
<span style="color:#f92672">from</span> XGBoost <span style="color:#f92672">import</span> XGBClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score
<span style="color:#75715e"># load data</span>
dataset <span style="color:#f92672">=</span> loadtxt(<span style="color:#e6db74">&#39;pima-indians-diabetes.csv&#39;</span>, delimiter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;,&#34;</span>)
<span style="color:#75715e"># split data into X and y</span>
X <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">8</span>]
Y <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">8</span>]
<span style="color:#75715e"># split data into train and test sets</span>
seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
test_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.33</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, Y, test_size<span style="color:#f92672">=</span>test_size, random_state<span style="color:#f92672">=</span>seed)
<span style="color:#75715e"># fit model on training data</span>
model <span style="color:#f92672">=</span> XGBClassifier()
eval_set <span style="color:#f92672">=</span> [(X_test, y_test)]
model<span style="color:#f92672">.</span>fit(X_train, y_train, early_stopping_rounds<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, eval_metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logloss&#34;</span>, eval_set<span style="color:#f92672">=</span>eval_set, verbose<span style="color:#f92672">=</span>True)
<span style="color:#75715e"># make predictions for test data</span>
predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#75715e"># evaluate predictions</span>
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, predictions)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Accuracy: </span><span style="color:#e6db74">%.2f%%</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (accuracy <span style="color:#f92672">*</span> <span style="color:#ae81ff">100.0</span>))
</code></pre></div><p>Kết quả chạy code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[<span style="color:#ae81ff">0</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.60491</span>
Will train until validation_0<span style="color:#f92672">-</span>logloss hasn<span style="color:#e6db74">&#39;t improved in 10 rounds.</span>
[<span style="color:#ae81ff">1</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.55934</span>
[<span style="color:#ae81ff">2</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.53068</span>
[<span style="color:#ae81ff">3</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.51795</span>
[<span style="color:#ae81ff">4</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.51153</span>
[<span style="color:#ae81ff">5</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.50935</span>
[<span style="color:#ae81ff">6</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.50818</span>
[<span style="color:#ae81ff">7</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.51097</span>
[<span style="color:#ae81ff">8</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.51760</span>
[<span style="color:#ae81ff">9</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.51912</span>
[<span style="color:#ae81ff">10</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.52503</span>
[<span style="color:#ae81ff">11</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.52697</span>
[<span style="color:#ae81ff">12</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.53335</span>
[<span style="color:#ae81ff">13</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.53905</span>
[<span style="color:#ae81ff">14</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.54546</span>
[<span style="color:#ae81ff">15</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.54613</span>
[<span style="color:#ae81ff">16</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.54982</span>
Stopping<span style="color:#f92672">.</span> Best iteration:
[<span style="color:#ae81ff">6</span>]	validation_0<span style="color:#f92672">-</span>logloss:<span style="color:#ae81ff">0.50818</span>

Accuracy: <span style="color:#ae81ff">74.41</span><span style="color:#f92672">%</span>
</code></pre></div><p>Quá trình train model dừng lại ở epoch 16 (<em>gần với những gì mà chúng ta phán đoán dựa trên đồ thị learning curve</em>) và model đạt được metric thấp nhất tại epoch 6. Việc chọn giá trị của tham số <code>early_stopping_rounds</code> thường dựa vào quan sát trên đồ thị <code>learning curve</code>. Nếu bạn không biết thì có thể chọn giá trị mặc định là 10.</p>
<p><strong>3. Kết luận</strong></p>
<p>Trong bài viết này, chúng ta đã tìm hiểu cách monitor performance của XGBoost model trong quá trình train và cấu hình <code>early stopping</code> để hạn chế hiện tượng <code>overfitting</code> của model.</p>
<p>Ở bài viết tiếp theo chúng ta sẽ tìm hiểu cách cấu hình XGBoost model để tận dụng hết tài nguyên của phần cứng khi train model và khi sử model để dự đoán. Hãy cùng đón đọc! :)</p>
<p><em>Toàn bộ source code của bài này các bạn có thể tham khảo trên github cá nhân của mình tại <a href="https://github.com/tiensu/XGBoost-algorithm/tree/master/early-stopping">github.</a></em></p>
<p>Bài viết có tham khảo tại <a href="https://machinelearningmastery.com/XGBoost-with-python/">tham khảo</a>.</p>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://tiensu.github.io/"><img src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical" style="height: auto"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:0869644890"><i
                class="ti-mobile mr-3 text-primary"></i>0869644890</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Hanoi, Vietnam</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:tiensunguyen2103@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>tiensunguyen2103@gmail.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://www.facebook.com/tiensunguyen2103">Facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/">Linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/algorithm-optimization">Algorithm Optimization</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/attention">Attention</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/autoencoder">Autoencoder</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/bert">BERT</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/cnn">CNN</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-driff">Data Driff</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-imbalance">Data imbalance</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-science">Data Science</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/deep-learning">Deep Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/docker">Docker</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ebook">Ebook</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ensemble-learning">Ensemble Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/face-recognition">Face Recognition</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/image-classification">Image Classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/kubernetes">Kubernetes</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/lstm">LSTM</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/machine-learning">Machine Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/mlops">MLOps</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/neural-network">Neural Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ocr">OCR</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/one-shot-learning">One Shot Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/project-management">Project Management</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/rnn">RNN</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/scalability">Scalability</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/siamese-network">Siamese Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/text-classification">Text Classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/transformer">Transformer</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/xgboost">XGBoost</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright © 2021 <a href="tiensu.github.io">SuNT</a>. All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://tiensu.github.io/index.json"
</script>

<!-- JS Plugins -->

<script src="https://tiensu.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://tiensu.github.io/plugins/slick/slick.min.js"></script>

<script src="https://tiensu.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/fuse.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/mark.js"></script>

<script src="https://tiensu.github.io/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://tiensu.github.io/js/script.min.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>