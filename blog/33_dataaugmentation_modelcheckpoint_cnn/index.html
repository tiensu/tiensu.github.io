<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>SuNT&#39;s Blog | AI in Practical</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="SuNT">
  <meta name="generator" content="Hugo 0.68.3" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/venobox/venobox.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/css/override.css">
  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://tiensu.github.io/"><img class="img-fluid"
          src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/tiensunguyen2103"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://tiensu.github.io/"><img class="img-fluid"
            src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/contact">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://tiensu.github.io//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/cnn"
          class="text-primary">C n n</a>
        
        <a href="/categories/image-classification"
          class="text-primary">Image Classification</a>
        
        <h2>Sử dụng kỹ thuật Data Augmentation và Model Checkpoint khi huấn luyện CNN model</h2>
        <div class="mb-3 post-meta">
          <span>By SuNT</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>10 December 2020</span>
          
        </div>
        
        <img src="https://tiensu.github.io/images/featured-post/31_cat_dog_dataset.jpg" class="img-fluid w-100 mb-4" alt="Sử dụng kỹ thuật Data Augmentation và Model Checkpoint khi huấn luyện CNN model">
        
        <div class="content mb-5">
          <p>Tiếp theo bài trước, trong bài này chúng ta sẽ áp dụng thêm 2 kỹ thuật mới vào CNN model Cat&amp;Dog classification:</p>
<ul>
<li>
<p>Data Augmentation: Đây là kỹ thuật tăng cường dữ liệu huấn luyện cho model. Nó đặc biệt hữu ích khi chúng ta có ít dữ liệu vì từ một ảnh gốc ban đầu, thông qua các phép biến đổi hình thái học (<em>xoay, lật, phóng to, thu nhỏ, thay đổi độ sáng, độ tương phải, &hellip;</em>) ta có thêm được nhiều ảnh mới. Kỹ thuật này không chỉ giới hạn trong các bài toán liên quan đến ảnh, mà các bài toán Data Science và NLP cũng có thể sử dụng được.


<div style="text-align:center">
    <img style="height:auto" src="/images/post/data_augmentation.png">
</div>

</p>
</li>
<li>
<p>Model Checkpoint: Đây thực chất là một hàm callback, được gọi sau mỗi epoch trong quá trình huấn luyện model. Nó sẽ lưu lại model nếu giá trị loss hoặc accuracy được cải thiện sau mỗi epoch.</p>
</li>
</ul>
<p>Cùng với <code>EarlyStopping</code> thì 2 kỹ thuật này được cũng được sử dụng rất thường xuyên để hạn chế hiện tượng overfitting của model.</p>
<p>Bây giờ, ta sẽ sử dụng chúng trong bài toán xây dựng CNN model phân loại Cat&amp;Dog.</p>
<p>Import thư viện:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> random
<span style="color:#f92672">import</span> tensorflow <span style="color:#f92672">as</span> tf
<span style="color:#f92672">import</span> shutil
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> tensorflow <span style="color:#f92672">import</span> keras
<span style="color:#f92672">from</span> tensorflow.keras.optimizers <span style="color:#f92672">import</span> RMSprop
<span style="color:#f92672">from</span> tensorflow.keras.callbacks <span style="color:#f92672">import</span> EarlyStopping, ModelCheckpoint
<span style="color:#f92672">from</span> tensorflow.keras.preprocessing.image <span style="color:#f92672">import</span> ImageDataGenerator

config <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>v1<span style="color:#f92672">.</span>ConfigProto()
config<span style="color:#f92672">.</span>gpu_options<span style="color:#f92672">.</span>allow_growth <span style="color:#f92672">=</span> True
session <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>v1<span style="color:#f92672">.</span>InteractiveSession(config<span style="color:#f92672">=</span>config)
</code></pre></div><p>Hai kỹ thuật <code>Data augmentation</code> và <code>Model checkpoint</code> sẽ được sử dụng thông qua lớp <a href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator">ImageDataGenerator</a> và <a href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ModelCheckpoint">ModelCheckpoint</a>, tương ứng.</p>
<p>Lớp <code>ImageDataGenerator</code> cho phép ta biến đổi ảnh gốc thành nhiều ảnh khác nhau thông quá các tham số truyền vào. Như trong hàm <code>gen_data()</code> dưới đây, ta sinh ra được 6 ảnh mới thông qua các phép biến đổi:</p>
<ul>
<li>Quay 40 độ</li>
<li>Dịch theo chiều rộng 0.2 pixcel</li>
<li>Dịch theo chiều cao 0.2 pixcel</li>
<li>Cắt (<em>xén</em>) 0.2 pixcel</li>
<li>Phóng to 0.2 pixcel</li>
<li>Lật ngang</li>
</ul>
<p>Chú ý rằng, các ảnh mới sinh ra không được lưu vào ổ cứng máy tính, mà chỉ được sinh ra tại thời điểm huấn luyện model và lưu tạm thời trong RAM. Khi kết thức quá trình training thì các ảnh đó cũng sẽ mất.</p>
<p>Tham số <code>fill_mode='nearest'</code> chỉ ra phương pháp bù lại giá trị cho những pixcel tại các vị trí bị mất mát do quá trình biến đổi. <code>Nearest</code> tức là dựa vào giá trị của các pixcel xung quanh, gần nó nhất (<em>theo một tiêu chuẩn nào đó</em>).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_data</span>():
    training_datagen <span style="color:#f92672">=</span> ImageDataGenerator(
        rescale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>,
        rotation_range<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span>,
        width_shift_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>,
        height_shift_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>,
        shear_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>,
        zoom_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>,
        horizontal_flip<span style="color:#f92672">=</span>True,
        fill_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;nearest&#39;</span>
    )
    validation_datagen <span style="color:#f92672">=</span> ImageDataGenerator(
        rescale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>
    )
    
    training_generator <span style="color:#f92672">=</span> training_datagen<span style="color:#f92672">.</span>flow_from_directory(
        <span style="color:#e6db74">&#39;cat-dog-dataset/train&#39;</span>,
        target_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">150</span>),
        batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>,
        class_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary&#39;</span>
    )
    
    validation_generator <span style="color:#f92672">=</span> validation_datagen<span style="color:#f92672">.</span>flow_from_directory(
        <span style="color:#e6db74">&#39;cat-dog-dataset/val&#39;</span>,
        target_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">150</span>),
        batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>,
        class_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary&#39;</span>
    )
    
    <span style="color:#66d9ef">return</span> training_generator, validation_generator
</code></pre></div><p>Tiếp theo, ta khai báo một instance của <code>ModelCheckpoint</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">callback_1 <span style="color:#f92672">=</span> ModelCheckpoint(
    <span style="color:#e6db74">&#39;cat_dog_model_checkpoint/weights-improvement-{epoch:02d}-{val_acc:.2f}.hdf5&#39;</span>, <span style="color:#75715e"># Tên model tại mỗi điểm checkpoint</span>
    monitor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;val_acc&#39;</span>, <span style="color:#75715e"># Giá trị cần theo dõi</span>
    save_best_only<span style="color:#f92672">=</span>True, <span style="color:#75715e"># Chỉ lưu những model tốt nhất đến thời điểm checkpoint</span>
    save_weights_only<span style="color:#f92672">=</span>True, <span style="color:#75715e"># Chỉ lưu weights của model (để giảm kích thước)</span>
    save_freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;epoch&#39;</span>, <span style="color:#75715e"># Checkpoint sau mỗi epoch</span>
    mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;auto&#39;</span>, <span style="color:#75715e"># Val_acc phải tăng mới tính là model được cải thiện. Nếu monitor=&#39;loss/val_loss&#39; thì nó phải giảm mới tính là model được cải thiện</span>
    verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#75715e"># Hiển thị thông tin model lúc checkpoint</span>
)
</code></pre></div><p>Chi tiết từng tham số của <code>ModelCheckpoint</code> instance được giải thích chi tiết theo các comments trong code khai báo.</p>
<p>Ta vẫn sử dụng thêm <code>EarlyStopping</code> để tiết kiệm thời gian training:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">callback_2 <span style="color:#f92672">=</span> EarlyStopping(monitor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;val_acc&#39;</span>, patience<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</code></pre></div><p>Kiến trúc CNN model vẫn giữ nguyên như bài trước:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_model</span>():
    model <span style="color:#f92672">=</span> keras<span style="color:#f92672">.</span>models<span style="color:#f92672">.</span>Sequential([
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Conv2D(<span style="color:#ae81ff">128</span>, (<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>, input_shape<span style="color:#f92672">=</span>(<span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">3</span>)),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>MaxPooling2D(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Conv2D(<span style="color:#ae81ff">64</span>, (<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>MaxPooling2D(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Conv2D(<span style="color:#ae81ff">32</span>, (<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>MaxPooling2D(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Flatten(),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Dense(<span style="color:#ae81ff">256</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Dense(<span style="color:#ae81ff">128</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>),
        keras<span style="color:#f92672">.</span>layers<span style="color:#f92672">.</span>Dense(<span style="color:#ae81ff">1</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sigmoid&#39;</span>)
    ])
    
    model<span style="color:#f92672">.</span>compile(optimizer<span style="color:#f92672">=</span>RMSprop(lr<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>), loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary_crossentropy&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;acc&#39;</span>])
    
    <span style="color:#66d9ef">return</span> model
</code></pre></div><p>Hàm <code>plot_chart</code> để thể hiện kết quả training lên đồ thị:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_chart</span>(history):
    acc <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;acc&#39;</span>]
    val_acc <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;val_acc&#39;</span>]
    loss <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;loss&#39;</span>]
    val_loss <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;val_loss&#39;</span>]

    epochs <span style="color:#f92672">=</span> range(len(acc))
    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))

    plt<span style="color:#f92672">.</span>plot(epochs, acc, <span style="color:#e6db74">&#39;r&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Training Accuracy&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(epochs, val_acc, <span style="color:#e6db74">&#39;b&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Validation Accuracy&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(epochs, loss, <span style="color:#e6db74">&#39;g&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Training Loss&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(epochs, val_loss, <span style="color:#e6db74">&#39;y&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Validation Loss&#39;</span>)

    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Traing and Validation, Accuracy and Loss&#39;</span>)
    plt<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
    plt<span style="color:#f92672">.</span>show()
</code></pre></div><p>Cuối cùng, gộp tất cả lại và train model:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">training_generator, validation_generator <span style="color:#f92672">=</span> gen_data()
model <span style="color:#f92672">=</span> create_model()

history <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(
    training_generator,
    epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>,
    validation_data<span style="color:#f92672">=</span>validation_generator,
    callbacks<span style="color:#f92672">=</span>[callback_1, callback_2],
    verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
)
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Found <span style="color:#ae81ff">20000</span> images belonging to <span style="color:#ae81ff">2</span> classes<span style="color:#f92672">.</span>
Found <span style="color:#ae81ff">5000</span> images belonging to <span style="color:#ae81ff">2</span> classes<span style="color:#f92672">.</span>
Epoch <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
  <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">..............................</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">17</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">1.6500</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.5469</span>WARNING:tensorflow:Callbacks method <span style="color:#e6db74">`on_train_batch_end`</span> <span style="color:#f92672">is</span> slow compared to the batch time (batch time: <span style="color:#ae81ff">0.0223</span>s vs <span style="color:#e6db74">`on_train_batch_end`</span> time: <span style="color:#ae81ff">0.0339</span>s)<span style="color:#f92672">.</span> Check your callbacks<span style="color:#f92672">.</span>
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.6804</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.5882</span>
Epoch <span style="color:#ae81ff">00001</span>: val_acc improved <span style="color:#f92672">from</span> <span style="color:#f92672">-</span>inf to <span style="color:#ae81ff">0.69340</span>, saving model to horse<span style="color:#f92672">-</span>humand_model_checkpoint<span style="color:#f92672">/</span>weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">01</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.69</span><span style="color:#f92672">.</span>hdf5
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">115</span>s <span style="color:#ae81ff">184</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.6804</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.5882</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.6017</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.6934</span>
Epoch <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.6239</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.6591</span>
Epoch <span style="color:#ae81ff">00002</span>: val_acc improved <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.69340</span> to <span style="color:#ae81ff">0.73060</span>, saving model to horse<span style="color:#f92672">-</span>humand_model_checkpoint<span style="color:#f92672">/</span>weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.73</span><span style="color:#f92672">.</span>hdf5
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">112</span>s <span style="color:#ae81ff">179</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.6239</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.6591</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.5446</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.7306</span>
Epoch <span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.5922</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.6922</span>
Epoch <span style="color:#ae81ff">00003</span>: val_acc improved <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.73060</span> to <span style="color:#ae81ff">0.76340</span>, saving model to horse<span style="color:#f92672">-</span>humand_model_checkpoint<span style="color:#f92672">/</span>weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.76</span><span style="color:#f92672">.</span>hdf5
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">113</span>s <span style="color:#ae81ff">181</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.5922</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.6922</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.5106</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.7634</span>
<span style="color:#f92672">............</span>
Epoch <span style="color:#ae81ff">30</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.4392</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.8173</span>
Epoch <span style="color:#ae81ff">00030</span>: val_acc did <span style="color:#f92672">not</span> improve <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.86600</span>
<span style="color:#ae81ff">625</span><span style="color:#f92672">/</span><span style="color:#ae81ff">625</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">112</span>s <span style="color:#ae81ff">179</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.4392</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.8173</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.4723</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.7768</span>
</code></pre></div><p>Model được train đầy đủ 30 epochs, không bị dừng giữa chừng do không thỏa mãn điều kiện của EarlyStopping.</p>
<p>Quan sát thư mục <code>cat_dog_model_checkpoint</code> ta cũng thấy model được lưu tại một số điểm checkpoint. Model có độ chính xác cao nhất tại epoch thứ 29.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">01</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.69</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">01</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.98</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.73</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1.00</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.76</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">05</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.80</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">07</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.81</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.83</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">12</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.83</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">17</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.83</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">20</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.85</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">24</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.86</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">└──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">29</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.87</span><span style="color:#f92672">.</span>hdf5
</code></pre></div><p>Kiểm tra quá trình huấn luyện bằng cách thể hiện giá trị loss và accuracy lên đồ thị:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plot_chart(history)
</code></pre></div>

<div style="text-align:center">
    <img style="height:auto" src="/images/post/cat-dog-chart_2.png">
</div>


<p>Các giá trị loss và accuracy tuy có sự dao động nhưng kết quả cuối cùng vẫn khá tốt. Model không bị overfit quá nhiều, có thể chấp nhận được.</p>
<p>Source code của bài này, các bạn có thể tham khảo trên github cá nhân của mình tại <a href="https://github.com/tiensu/Computer_Vision/blob/master/Deep_Learning/DataAugmentation_ModelCheckpoint.ipynb">đây</a>.</p>
<p>Bài tiếp theo, ta sẽ học thêm một kỹ thuật rất thú vị nữa, giúp chúng ta giảm rất nhiều công sức trong việc huấn luyện model, đó là <code>Tranfer Learning</code>. Mời các bạn đón đọc!</p>
<p><strong>Tham khảo</strong></p>
<ul>
<li><a href="https://www.coursera.org/professional-certificates/tensorflow-in-practice">Coursera</a></li>
</ul>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://tiensu.github.io/"><img src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical" style="height: auto"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:0869644890"><i
                class="ti-mobile mr-3 text-primary"></i>0869644890</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Hanoi, Vietnam</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:tiensunguyen2103@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>tiensunguyen2103@gmail.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://www.facebook.com/tiensunguyen2103">Facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/">Linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/algorithm-optimization">Algorithm Optimization</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/attention">Attention</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/autoencoder">Autoencoder</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/bert">BERT</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/cnn">CNN</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-driff">Data Driff</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-science">Data Science</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/deep-learning">Deep Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/docker">Docker</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ebook">Ebook</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ensemble-learning">Ensemble Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/face-recognition">Face Recognition</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/image-classification">Image Classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/kubernetes">Kubernetes</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/lstm">LSTM</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/machine-learning">Machine Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/mlops">MLOps</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/neural-network">Neural Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/one-shot-learning">One Shot Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/project-management">Project Management</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/rnn">RNN</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/scalability">Scalability</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/siamese-network">Siamese Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/text-classification">Text Classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/transformer">Transformer</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/xgboost">XGBoost</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright © 2021 <a href="tiensu.github.io">SuNT</a>. All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://tiensu.github.io/index.json"
</script>

<!-- JS Plugins -->

<script src="https://tiensu.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://tiensu.github.io/plugins/slick/slick.min.js"></script>

<script src="https://tiensu.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/fuse.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/mark.js"></script>

<script src="https://tiensu.github.io/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://tiensu.github.io/js/script.min.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>