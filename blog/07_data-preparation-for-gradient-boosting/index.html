<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>SuNT&#39;s Blog | AI in Practical</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="SuNT">
  <meta name="generator" content="Hugo 0.68.3" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/venobox/venobox.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/css/override.css">
  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://tiensu.github.io/"><img class="img-fluid"
          src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/tiensunguyen2103"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://tiensu.github.io/"><img class="img-fluid"
            src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/contact">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://tiensu.github.io//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/machine-learning"
          class="text-primary">Machine Learning</a>
        
        <a href="/categories/xgboost"
          class="text-primary">X g boost</a>
        
        <h2>XGBoost - Bài 4: Chuẩn bị dữ liệu cho XGBoost model</h2>
        <div class="mb-3 post-meta">
          <span>By SuNT</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>05 September 2020</span>
          
        </div>
        
        <img src="https://tiensu.github.io/images/featured-post/xgboost_data_preparation.jpg" class="img-fluid w-100 mb-4" alt="XGBoost - Bài 4: Chuẩn bị dữ liệu cho XGBoost model">
        
        <div class="content mb-5">
          <p>XGBoost là một thuật toán thuộc họ Gradient Boosting. Những ưu điểm vượt trội của nó đã được chứng minh qua các cuộc thi trên <a href="kaggke.com">kaggle</a>. Dữ liệu đầu vào cho XGBoost model phải ở dạng số. Nếu dữ liệu không ở dạng số thì phải được chuyển qua dạng số  (<code>numeric</code>) trước khi đưa vào XGBoost model để train. Có một vài phương pháp để thực hiện việc này, hãy cùng nhau điểm qua trong phần còn lại của bài viết.</p>
<p>Sau khi xem hết bài viết này, bạn sẽ biết:</p>
<ul>
<li>Làm thế nào để mã hóa chuỗi (<code>string</code>) đầu ra cho việc phân loại?</li>
<li>Làm thế nào để mã hóa dữ liệu đầu vào kiểu &ldquo;categorical&rdquo; sử dụng mã hóa one-hot (<code>one hot encoding</code>).</li>
<li>Làm thế nào để tự động xử lý vấn đề thiếu dữ liệu trong dataset (<code>missing data</code>)?</li>
</ul>
<p><strong>1. Mã hóa chuỗi đầu ra</strong></p>
<p>Chúng ta sẽ sử dụng bài toán phân loại hoa Iris để minh họa cho vấn đề này. Đưa vào các số liệu đo đặc các thành phần của hoa Iris, cần dự đoán hoa Iris đó thuộc loại nào (đầu ra dự đoán của model là các chuỗi ký tự).</p>
<p>Hãy xem ví dụ của <a href="http://archive.ics.uci.edu/ml/datasets/Ir">dataset</a>:</p>
<pre><code>5.1,3.5,1.4,0.2,Iris-setosa
4.9,3.0,1.4,0.2,Iris-setosa
4.7,3.2,1.3,0.2,Iris-setosa
4.6,3.1,1.5,0.2,Iris-setosa
5.0,3.6,1.4,0.2,Iris-setosa
</code></pre><p>XGBoost sẽ không thể mô hình hóa bài toán này bởi vì nó yêu cầu dữ liệu đầu vào phải ở dạng số. Chúng ta có thể dễ dang chuyển đổi từ kiểủ chuổi (string) sang kiểu số (<code>integer</code>) sử dụng lớp <code>LabelEncoder</code> của thư viện <code>sklearn</code>. Ba giá trị đầu ra kiểu <code>string</code> (<code>Iris-setosa, Iris-versicolor, Iris-virginica</code>) sẽ được ánh xạ thành các giá trị số tương ứng (0, 1, 2):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># encode string class values as integers</span>
label_encoder <span style="color:#f92672">=</span> LabelEncoder()
label_encoder <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit(Y)
label_encoded_y <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>transform(Y)
</code></pre></div><p>Chúng ta cần lưu lại bộ mã hóa này để chuyển đổi ngược lại từ số sang chuỗi trong quá trình dự đoán.</p>
<p>Dưới đây là toàn bộ code minh họa việc việc đọc dataset, mã hóa dữ liệu đầu ra, train XGBoost model và đánh giá độ chính xác của model đó:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># multiclass classification</span>
<span style="color:#f92672">from</span> pandas <span style="color:#f92672">import</span> read_csv
<span style="color:#f92672">from</span> XGBoost <span style="color:#f92672">import</span> XGBClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder
<span style="color:#75715e"># load data</span>
data <span style="color:#f92672">=</span> read_csv(<span style="color:#e6db74">&#39;iris.csv&#39;</span>, header<span style="color:#f92672">=</span>None)
dataset <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>values
<span style="color:#75715e"># split data into X and y</span>
X <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">4</span>]
Y <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">4</span>]
<span style="color:#75715e"># encode string class values as integers</span>
label_encoder <span style="color:#f92672">=</span> LabelEncoder()
label_encoder <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit(Y)
label_encoded_y <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>transform(Y)
seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
test_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.33</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, label_encoded_y,test_size<span style="color:#f92672">=</span>test_size, random_state<span style="color:#f92672">=</span>seed)
<span style="color:#75715e"># fit model on training data</span>
model <span style="color:#f92672">=</span> XGBClassifier()
model<span style="color:#f92672">.</span>fit(X_train, y_train)
<span style="color:#66d9ef">print</span>(model)
<span style="color:#75715e"># make predictions for test data</span>
predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#75715e"># evaluate predictions</span>
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, predictions)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Accuracy: </span><span style="color:#e6db74">%.2f%%</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (accuracy <span style="color:#f92672">*</span> <span style="color:#ae81ff">100.0</span>))
</code></pre></div><p>Chạy đoạn code trên, được kết quả như sau:</p>
<pre><code>XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,
              importance_type='gain', interaction_constraints='',
              learning_rate=0.300000012, max_delta_step=0, max_depth=6,
              min_child_weight=1, missing=nan, monotone_constraints='()',
              n_estimators=100, n_jobs=0, num_parallel_tree=1,
              objective='multi:softprob', random_state=0, reg_alpha=0,
              reg_lambda=1, scale_pos_weight=None, subsample=1,
              tree_method='exact', validate_parameters=1, verbosity=None)
Accuracy: 92.00%

</code></pre><p><strong>2. Mã hóa one-code dữ liệu kiểu Categorical</strong></p>
<p>Rất nhiều bộ dataset chứa các dữ liệu kiểu <code>categorical</code>. Trong phần này, chúng ta sử dụng bộ dataset <a href="http://archive.ics.uci.edu/ml/datasets/Breast+Canc">breast cancer</a> để  làm việc. Bộ dataset này miêu tả thông tin của y tế của các bệnh nhân, nhãn của nó chỉ ra bệnh nhân đó có bị ung thư hay không.</p>
<p>Ví dụ của bộ dữ liệu này như bên dưới:</p>
<pre><code>'40-49','premeno','15-19','0-2','yes','3','right','left_up','no','recurrence-events'
'50-59','ge40','15-19','0-2','no','1','right','central','no','no-recurrence-events'
'50-59','ge40','35-39','0-2','no','2','left','left_low','no','recurrence-events'
'40-49','premeno','35-39','0-2','yes','3','right','left_low','yes','no-recurrence-events'
'40-49','premeno','30-34','3-5','yes','2','left','right_up','no','recurrence-events'
</code></pre><p>Chúng ta nhìn thấy rằng tất cả 9 giá trị input đều ở là kiểu <code>categorical</code> và được thể hiện ở dạng <code>string</code>. Đây cũng là bài toán phân lớp nhị phân và nhãn cần dự đoán cũng đang ở dạng <code>string</code>. Vì vậy, ta có thể sử dụng lại cách tiếp cận ở phần trước, chuyển các giá trị dạng <code>string</code> sang <code>integer</code> sử dụng <code>LabelEncoder</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># encode string input values as integers</span>
features <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]):
    label_encoder <span style="color:#f92672">=</span> LabelEncoder()
    feature <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit_transform(X[:,i])
    features<span style="color:#f92672">.</span>append(feature)
encoded_x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(features)
encoded_x <span style="color:#f92672">=</span> encoded_x<span style="color:#f92672">.</span>reshape(X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>])
</code></pre></div><p>Khi sử dụng <code>LabelEncoder</code>, XGBoost có thể hiểu rằng các giá trị <code>encoded integer</code> của mỗi <code>input feature</code> có mối quan hệ thứ tự. Ví dụ, đối với <code>input feature</code> <code>breast-quad</code>, giá trị <code>left-up</code> được mã hóa là 0, <code>left-low</code> được mã hóa là 1. Điều này thực tế là không đúng trong trường hợp này. Để tránh điều này, ta phải ánh xạ các giá trị <code>integer</code> thành 1 giá trị kiểu <code>binary</code>.
Ví dụ, các giá trị của biến đầu vào <code>breast-quad</code> là:</p>
<pre><code>left-up
left-low
right-up
right-low
central
</code></pre><p>được ánh xạ thành 5 giá trị <code>binary</code> tương ứng:</p>
<pre><code>1,0,0,0,0
0,1,0,0,0
0,0,1,0,0
0,0,0,1,0
0,0,0,0,1
</code></pre><p>Điều này được gọi là OneHotEncoder. Ta có thể mã hóa <code>OneHot</code> tất cả các <code>input features</code> kiểu <code>categorical</code> sử dụng lớp <code>OneHotEncoder</code> của thư viện <code>scikit-leaen</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">onehot_encoder <span style="color:#f92672">=</span> OneHotEncoder(sparse<span style="color:#f92672">=</span>False, categories<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">✬</span>auto<span style="color:#960050;background-color:#1e0010">✬</span>)
feature <span style="color:#f92672">=</span> onehot_encoder<span style="color:#f92672">.</span>fit_transform(feature)
</code></pre></div><p><code>OneHot Encoder</code> cho tất cả <code>input features</code> của dữ liệu:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># encode string input values as integers</span>
columns <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]):
    label_encoder <span style="color:#f92672">=</span> LabelEncoder()
    feature <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit_transform(X[:,i])
    feature <span style="color:#f92672">=</span> feature<span style="color:#f92672">.</span>reshape(X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">1</span>)
    onehot_encoder <span style="color:#f92672">=</span> OneHotEncoder(sparse<span style="color:#f92672">=</span>False, categories<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">✬</span>auto<span style="color:#960050;background-color:#1e0010">✬</span>)
    feature <span style="color:#f92672">=</span> onehot_encoder<span style="color:#f92672">.</span>fit_transform(feature)
    columns<span style="color:#f92672">.</span>append(feature)
<span style="color:#75715e"># collapse columns into array</span>
encoded_x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>column_stack(columns)
</code></pre></div><p>Nếu biết chắc chắn răng một <code>input feature</code> nào đó có mối quan hệ về thứ tự, có thể bỏ qua <code>OneHot Encoder</code> mà chỉ cần <code>LabelEncoder</code> cho <code>feature</code> đó.</p>
<p>Toàn bộ source code của phần này:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># binary classification, breast cancer dataset, label and one hot encoded</span>
<span style="color:#f92672">from</span> numpy <span style="color:#f92672">import</span> column_stack
<span style="color:#f92672">from</span> pandas <span style="color:#f92672">import</span> read_csv
<span style="color:#f92672">from</span> XGBoost <span style="color:#f92672">import</span> XGBClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> OneHotEncoder
<span style="color:#75715e"># load data</span>
data <span style="color:#f92672">=</span> read_csv(<span style="color:#960050;background-color:#1e0010">✬</span>datasets<span style="color:#f92672">-</span>uci<span style="color:#f92672">-</span>breast<span style="color:#f92672">-</span>cancer<span style="color:#f92672">.</span>csv<span style="color:#960050;background-color:#1e0010">✬</span>, header<span style="color:#f92672">=</span>None)
dataset <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>values
<span style="color:#75715e"># split data into X and y</span>
X <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">9</span>]
X <span style="color:#f92672">=</span> X<span style="color:#f92672">.</span>astype(str)
Y <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">9</span>]
<span style="color:#75715e"># encode string input values as integers</span>
columns <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]):
    label_encoder <span style="color:#f92672">=</span> LabelEncoder()
    feature <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit_transform(X[:,i])
    feature <span style="color:#f92672">=</span> feature<span style="color:#f92672">.</span>reshape(X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">1</span>)
    onehot_encoder <span style="color:#f92672">=</span> OneHotEncoder(sparse<span style="color:#f92672">=</span>False, categories<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">✬</span>auto<span style="color:#960050;background-color:#1e0010">✬</span>)
    feature <span style="color:#f92672">=</span> onehot_encoder<span style="color:#f92672">.</span>fit_transform(feature)
columns<span style="color:#f92672">.</span>append(feature)
<span style="color:#75715e"># collapse columns into array</span>
encoded_x <span style="color:#f92672">=</span> column_stack(columns)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;X shape: : &#34;</span>, encoded_x<span style="color:#f92672">.</span>shape)
<span style="color:#75715e"># encode string class values as integers</span>
label_encoder <span style="color:#f92672">=</span> LabelEncoder()
label_encoder <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit(Y)
label_encoded_y <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>transform(Y)
<span style="color:#75715e"># split data into train and test sets</span>
seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
test_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.33</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(encoded_x, label_encoded_y,
    test_size<span style="color:#f92672">=</span>test_size, random_state<span style="color:#f92672">=</span>seed)
<span style="color:#75715e"># fit model on training data</span>
model <span style="color:#f92672">=</span> XGBClassifier()
model<span style="color:#f92672">.</span>fit(X_train, y_train)
<span style="color:#66d9ef">print</span>(model)
<span style="color:#75715e"># make predictions for test data</span>
predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#75715e"># evaluate predictions</span>
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, predictions)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Accuracy: </span><span style="color:#e6db74">%.2f%%</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (accuracy <span style="color:#f92672">*</span> <span style="color:#ae81ff">100.0</span>))
</code></pre></div><p>Chạy code trên ta được kết quả:</p>
<pre><code>('X shape: : ', (286, 43))
XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,
              importance_type='gain', interaction_constraints='',
              learning_rate=0.300000012, max_delta_step=0, max_depth=6,
              min_child_weight=1, missing=nan, monotone_constraints='()',
              n_estimators=100, n_jobs=0, num_parallel_tree=1, random_state=0,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, subsample=1,
              tree_method='exact', validate_parameters=1, verbosity=None)
Accuracy: 68.42%
</code></pre><p><strong>3. Giải quyết vấn đề <code>missing data</code></strong></p>
<p>XGBoost có thể tự động học cách để đưa ra cách giải quyết tốt nhất cho vấn đề  <code>missing data</code>. Trên thực tế, XGBoost được thiết kế để làm việc với <code>sparse data</code>, giống như <code>one hot encoded data</code> ở phần trước. Chi tiết hơn về các kỹ thuật xử lý <code>missing data</code> của XGBoost, có thể tham khảo <em>Section 3.4 Sparsity-aware Split Finding</em> trong bài báo <a href="https://arxiv.org/abs/1603.027">XGBoost: A Scalable Tree Boosting System</a>.</p>
<p>Trong phần này, ta sẽ sử dụng <a href="https://archive.ics.uci.edu/ml/datasets/Horse+Col">Horse Colic dataset</a> để minh họa khả năng xử lý <code>missing data</code> của XGBoost. Trong dataset này, tỷ lệ <code>mising data</code> tương dối lớn, rơi vào khoảng 30%.</p>
<p>Dễ dàng đọc được dataset này với thư viện <code>Pandas</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataframe <span style="color:#f92672">=</span> read_csv(<span style="color:#e6db74">&#34;horse-colic.csv&#34;</span>, delim_whitespace<span style="color:#f92672">=</span>True, header<span style="color:#f92672">=</span>None)
dataframe<span style="color:#f92672">.</span>head()
</code></pre></div><p>Ta có thể quan sát thấy rằng, <code>missing data</code> được đánh dấu bằng dấu <code>?</code>.</p>
<pre><code> 0   1        2      3    4   5  6  7  8  9  10 11 12 13 14    15 16 17     18    19 20    21 22  23     24  25  26  27
0  2   1   530101  38.50   66  28  3  3  ?  2  5  4  4  ?  ?     ?  3  5  45.00  8.40  ?     ?  2   2  11300   0   0   2
1  1   1   534817   39.2   88  20  ?  ?  4  1  3  4  2  ?  ?     ?  4  2     50    85  2     2  3   2   2208   0   0   2
2  2   1   530334  38.30   40  24  1  1  3  1  3  3  1  ?  ?     ?  1  1  33.00  6.70  ?     ?  1   2      0   0   0   1
3  1   9  5290409  39.10  164  84  4  1  6  2  2  4  4  1  2  5.00  3  ?  48.00  7.20  3  5.30  2   1   2208   0   0   1
4  2   1   530255  37.30  104  35  ?  ?  6  2  ?  ?  ?  ?  ?     ?  ?  ?  74.00  7.40  ?     ?  2   2   4300   0   0   2
</code></pre><p>Thay <code>?</code> bởi giá trị 0:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># set missing values to 0</span>
X[X <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;?&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#75715e"># convert to numeric</span>
X <span style="color:#f92672">=</span> X<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float32&#39;</span>)
</code></pre></div><p>Bài toán đối với dataset này là <code>Binary Classification</code>, nhãn bao gồm 2 giá trị là 1 và 2. Ta dễ dàng chuyển sang 0 và 1 sử dụng <code>LabelEncoder</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># encode Y class values as integers</span>
label_encoder <span style="color:#f92672">=</span> LabelEncoder()
label_encoder <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit(Y)
label_encoded_y <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>transform(Y)
</code></pre></div><p>Code đầy đủ:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># binary classification, missing data</span>
<span style="color:#f92672">from</span> pandas <span style="color:#f92672">import</span> read_csv
<span style="color:#f92672">from</span> XGBoost <span style="color:#f92672">import</span> XGBClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder
<span style="color:#75715e"># load data</span>
dataframe <span style="color:#f92672">=</span> read_csv(<span style="color:#e6db74">&#34;horse-colic.csv&#34;</span>, delim_whitespace<span style="color:#f92672">=</span>True, header<span style="color:#f92672">=</span>None)
dataset <span style="color:#f92672">=</span> dataframe<span style="color:#f92672">.</span>values
<span style="color:#75715e"># split data into X and y</span>
X <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">27</span>]
Y <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">27</span>]
<span style="color:#75715e"># set missing values to 0</span>
X[X <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;?&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#75715e"># convert to numeric</span>
X <span style="color:#f92672">=</span> X<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float32&#39;</span>)
<span style="color:#75715e"># encode Y class values as integers</span>
label_encoder <span style="color:#f92672">=</span> LabelEncoder()
label_encoder <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit(Y)
label_encoded_y <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>transform(Y)
<span style="color:#75715e"># split data into train and test sets</span>
seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
test_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.33</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, label_encoded_y,
    test_size<span style="color:#f92672">=</span>test_size, random_state<span style="color:#f92672">=</span>seed)
<span style="color:#75715e"># fit model on training data</span>
model <span style="color:#f92672">=</span> XGBClassifier()
model<span style="color:#f92672">.</span>fit(X_train, y_train)
<span style="color:#66d9ef">print</span>(model)
<span style="color:#75715e"># make predictions for test data</span>
predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#75715e"># evaluate predictions</span>
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, predictions)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Accuracy: </span><span style="color:#e6db74">%.2f%%</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (accuracy <span style="color:#f92672">*</span> <span style="color:#ae81ff">100.0</span>))
</code></pre></div><p>Output:</p>
<pre><code>XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,
              importance_type='gain', interaction_constraints='',
              learning_rate=0.300000012, max_delta_step=0, max_depth=6,
              min_child_weight=1, missing=nan, monotone_constraints='()',
              n_estimators=100, n_jobs=0, num_parallel_tree=1, random_state=0,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, subsample=1,
              tree_method='exact', validate_parameters=1, verbosity=None)
Accuracy: 82.83%
</code></pre><p>Hãy kiểm tra khả năng của XGBoost bằng cách thử thay <code>missing value</code> với các giá trị khác nhau:</p>
<ul>
<li>Thay <code>missing value</code> bởi 1</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">X[X <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;?`] = 1</span>
</code></pre></div><p>Kết quả:</p>
<pre><code>Accuracy: 81.82%
</code></pre><ul>
<li>Thay <code>missing value</code> bởi NaN</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">X[X <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;?`] = 1</span>
</code></pre></div><p>Kết quả:</p>
<pre><code>Accuracy: 83.84%
</code></pre><ul>
<li>Thay thế  <code>missing value</code> bằng giá trị trung bình (<code>mean</code>) của toàn bộ <code>feature</code> đó</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># impute missing values as the mean</span>
imputer <span style="color:#f92672">=</span> SimpleImputer()
imputed_x <span style="color:#f92672">=</span> imputer<span style="color:#f92672">.</span>fit_transform(X)
</code></pre></div><p>Source đầy đủ:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># binary classification, missing data, impute with mean</span>
<span style="color:#f92672">import</span> numpy
<span style="color:#f92672">from</span> pandas <span style="color:#f92672">import</span> read_csv
<span style="color:#f92672">from</span> XGBoost <span style="color:#f92672">import</span> XGBClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> Imputer
<span style="color:#75715e"># load data</span>
dataframe <span style="color:#f92672">=</span> read_csv(<span style="color:#e6db74">&#34;horse-colic.csv&#34;</span>, delim_whitespace<span style="color:#f92672">=</span>True, header<span style="color:#f92672">=</span>None)
dataset <span style="color:#f92672">=</span> dataframe<span style="color:#f92672">.</span>values
<span style="color:#75715e"># split data into X and y</span>
X <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">27</span>]
Y <span style="color:#f92672">=</span> dataset[:,<span style="color:#ae81ff">27</span>]
<span style="color:#75715e"># set missing values to NaN</span>
X[X <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;?&#39;</span>] <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>nan
<span style="color:#75715e"># convert to numeric</span>
X <span style="color:#f92672">=</span> X<span style="color:#f92672">.</span>astype(<span style="color:#960050;background-color:#1e0010">✬</span>float32<span style="color:#960050;background-color:#1e0010">✬</span>)
<span style="color:#75715e"># impute missing values as the mean.</span>
imputer <span style="color:#f92672">=</span> Imputer()
imputed_x <span style="color:#f92672">=</span> imputer<span style="color:#f92672">.</span>fit_transform(X)
<span style="color:#75715e"># encode Y class values as integers</span>
label_encoder <span style="color:#f92672">=</span> LabelEncoder()
label_encoder <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>fit(Y)
label_encoded_y <span style="color:#f92672">=</span> label_encoder<span style="color:#f92672">.</span>transform(Y)
<span style="color:#75715e"># split data into train and test sets</span>
seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
test_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.33</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(imputed_x, label_encoded_y,
test_size<span style="color:#f92672">=</span>test_size, random_state<span style="color:#f92672">=</span>seed)
<span style="color:#75715e"># fit model on training data</span>
model <span style="color:#f92672">=</span> XGBClassifier()
model<span style="color:#f92672">.</span>fit(X_train, y_train)
<span style="color:#66d9ef">print</span>(model)
<span style="color:#75715e"># make predictions for test data</span>
predictions <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#75715e"># evaluate predictions</span>
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, predictions)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Accuracy: </span><span style="color:#e6db74">%.2f%%</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (accuracy <span style="color:#f92672">*</span> <span style="color:#ae81ff">100.0</span>))
</code></pre></div><p>Kết quả:</p>
<pre><code>XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,
              importance_type='gain', interaction_constraints='',
              learning_rate=0.300000012, max_delta_step=0, max_depth=6,
              min_child_weight=1, missing=nan, monotone_constraints='()',
              n_estimators=100, n_jobs=0, num_parallel_tree=1, random_state=0,
              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, subsample=1,
              tree_method='exact', validate_parameters=1, verbosity=None)
Accuracy: 81.82%
</code></pre><p>Có thể thấý rằng, đối với bài toán này, giải pháp thay thế <code>missing value</code> bằng NaN mang lại kết quả tốt nhất. Trong các bài toán thực tế, chúng ta cũng cần phải <code>thử-sai</code> nhiều cách khác nhau để chọn được phương pháp tối ưu cho bài toán đó.</p>
<p><strong>4. Kết luận</strong></p>
<p>Trong bài viết này chúng ta đã cùng nhau tìm hiểu các cách để chuẩn bị dữ liệu cho việc train XGBoost model. Cụ thể:</p>
<ul>
<li>Mã hóa dữ liệu kiểu <code>string</code> bằng <code>LabelEncoder</code></li>
<li>Mã hóa dữ liệu kiểu <code>categorical</code> bằng <code>OneHot Encoder</code></li>
<li>Xử lý <code>missing data</code></li>
</ul>
<p>Trong bài tiếp theo, chúng ta sẽ tìm hiểu các phương pháp đánh giá hiệu năng của XGBoost model.</p>
<p><em>Toàn bộ source code của bài này các bạn có thể tham khảo trên github cá nhân của mình tại <a href="https://github.com/tiensu/XGBoost-algorithm/tree/master/prepare_data">github.</a></em></p>
<p>Bài viết có tham khảo tại <a href="https://machinelearningmastery.com/XGBoost-with-python/">tham khảo</a></p>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://tiensu.github.io/"><img src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical" style="height: auto"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:0869644890"><i
                class="ti-mobile mr-3 text-primary"></i>0869644890</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Hanoi, Vietnam</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:tiensunguyen2103@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>tiensunguyen2103@gmail.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://www.facebook.com/tiensunguyen2103">Facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/">Linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/algorithm-optimization">Algorithm Optimization</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/artificial-intelligent">Artificial Intelligent</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/convolution-neural-network">Convolution Neural Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-science">Data Science</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/deep-learning">Deep Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ebook">Ebook</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ensemble-learning">Ensemble Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/image-classification">Image classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/machine-learning">Machine Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/model-deployment">Model deployment</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/neural-network">Neural Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/project-management">Project Management</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/text-classification">Text classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/xgboost">Xgboost</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright © 2021 <a href="tiensu.github.io">SuNT</a>. All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://tiensu.github.io/index.json"
</script>

<!-- JS Plugins -->

<script src="https://tiensu.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://tiensu.github.io/plugins/slick/slick.min.js"></script>

<script src="https://tiensu.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/fuse.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/mark.js"></script>

<script src="https://tiensu.github.io/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://tiensu.github.io/js/script.min.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>