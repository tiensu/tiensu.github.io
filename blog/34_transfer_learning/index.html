<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>SuNT&#39;s Blog | AI in Practical</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="SuNT">
  <meta name="generator" content="Hugo 0.68.3" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/venobox/venobox.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/css/override.css">
  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://tiensu.github.io/"><img class="img-fluid"
          src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/tiensunguyen2103"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://tiensu.github.io/"><img class="img-fluid"
            src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/contact">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://tiensu.github.io//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/convolution-neural-network"
          class="text-primary">Convolution neural network</a>
        
        <a href="/categories/image-classification"
          class="text-primary">Image classification</a>
        
        <h2>Sử dụng kỹ thuật Transfer Learning khi huấn luyện CNN model</h2>
        <div class="mb-3 post-meta">
          <span>By SuNT</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>15 December 2020</span>
          
        </div>
        
        <img src="https://tiensu.github.io/images/featured-post/32_horse_humand.png" class="img-fluid w-100 mb-4" alt="Sử dụng kỹ thuật Transfer Learning khi huấn luyện CNN model">
        
        <div class="content mb-5">
          <p>Trong các bài toán thực tế, khi làm việc với bộ dataset lớn và kiến trúc model phức tạp, việc huấn luyện model sẽ mất rất nhiều thời gian. Vài ngày hoặc thậm chí cả tuần mới ra được kết quả. Nếu ta chỉ train một lần thì không có gì đáng nói, nhưng thường thì ta sẽ train đi train lại rất nhiều lần, mỗi lần điều chỉnh hyper-parameter lại phải chạy train lại. Việc này quả thực rât rất mất thời gian và chán nản.</p>
<p>Hoặc khi chỉ có một lượng nhỏ dữ liệu để train model, chắc chắn sẽ cho ra một model không tốt, vì nó không học được kết các khía cạnh của dữ liệu. Khi triển khai thực tế chắc chắn sẽ thất bại.</p>
<p>Kỹ thuật <code>Transfer Learning</code> ra đời để giải quyết khó khăn này. Ý tưởng chính của nó là tận dụng lại những model kinh diển (<em>VGG, Resnet, InceptionNet, &hellip;</em>), đã được train trên những tập dữ liệu lớn (<em>pre-trained models</em>), loại bỏ các layers classification ở gần cuối (<em>thường là các lớp FC</em>), chỉ giữ lại các layers ở đầu làm nhiệm vụ trích xuất đặc trưng của dữ liệu.</p>
<p>Có 2 loại transfer learning:</p>
<ul>
<li>Feature extractor: Sử dụng pre-trained model như là bộ trích xuất đặc trưng của dữ liệu. Các đặc trưng này sau đó sẽ được phân loại sử dụng các thuật toán ML như kNN, SVM, Decision Tree, &hellip;</li>
<li>Fine tuning: Loại bỏ các layers cuối làm nhiệm vụ phân loại trong pre-trained model, thêm vào các layers mới dựa theo bộ dữ liệu mà chúng ta có. Sau đó, train lại model tại những layers mà ta mới thêm vào.</li>
</ul>
<p>Vậy thì khi nào ta nên sử dụng <code>Transfer Learning</code>?</p>
<p>Dựa trên kích thước và độ tương quan giữa CSDL mới và CSDL gốc (chủ yếu là ImageNet) để train các mô hình có sẵn, CS231n đưa ra một vài lời khuyên:</p>
<ul>
<li>
<p>CSDL mới là nhỏ và tương tự như CSDL gốc. Vì CSDL mới nhỏ, việc tiếp tục train model dễ dẫn đến hiện tượng overfitting. Cũng vì hai CSDL là tương tự nhau, ta dự đoán rằng các high-level features là tương tự nhau. Vậy nên ta không cần train lại model mà chỉ cần train một classifer dựa trên feature vectors ở đầu ra ở layer gần cuối.</p>
</li>
<li>
<p>CSDL mới là lớn và tương tự như CSDL gốc. Vì CSDL này lớn, overfitting ít có khả năng xảy ra hơn, ta có thể train mô hình thêm một chút nữa (toàn bộ hoặc chỉ một vài layers cuối).</p>
</li>
<li>
<p>CSDL mới là nhỏ và rất khác với CSDL gốc. Vì CSDL này nhỏ, tốt hơn hết là dùng các classifier đơn giản (các linear classifiers) để tránh overfitting). Nếu muốn train thêm, ta cũng chỉ nên train các layer cuối. Hoặc có một kỹ thuật khác là coi đầu ra của một layer xa layer cuối hơn làm các feature vectors.</p>
</li>
<li>
<p>CSDL mới là lớn và rất khác CSDL gốc. Trong trường hợp này, ta vẫn có thể sử dụng mô hình đã train như là điểm khởi tạo cho mô hình mới, không nên train lại từ đầu.</p>
</li>
</ul>
<p>Có một điểm đáng chú ý nữa là khi tiếp tục train các mô hình này, ta chỉ nên chọn learning rate nhỏ để các weights mới không đi quá xa so với các weights đã được trained ở các mô hình trước.</p>
<p>OK, ta sẽ bắt tay vào thực hành kỹ thuật này (<em>theo cách thứ 2</em>) ngay bây giờ!</p>
<p>Yêu cầu bài toán là huấn luyện một CNN model để phân loại ảnh chứa ngựa và người trong bộ dataset <a href="https://www.kaggle.com/sanikamal/horses-or-humans-dataset">horse-or-humand</a>.</p>
<p>Download bộ dataset <code>horse-or-humand</code> về máy tính, giải nén và sử dụng thư viện <code>split-folders</code> để chia thành 2 phần train set và validation set.</p>
<p>Đầu tiên, import các thư viện cần thiết:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> tensorflow <span style="color:#f92672">as</span> tf
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> tensorflow.keras <span style="color:#f92672">import</span> layers
<span style="color:#f92672">from</span> tensorflow.keras <span style="color:#f92672">import</span> Model
<span style="color:#f92672">from</span> tensorflow.keras.optimizers <span style="color:#f92672">import</span> RMSprop
<span style="color:#f92672">from</span> tensorflow.keras.callbacks <span style="color:#f92672">import</span> ModelCheckpoint, EarlyStopping
<span style="color:#f92672">from</span> tensorflow.keras.preprocessing.image <span style="color:#f92672">import</span> ImageDataGenerator
<span style="color:#f92672">from</span> tensorflow.keras.applications.inception_v3 <span style="color:#f92672">import</span> InceptionV3

config <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>v1<span style="color:#f92672">.</span>ConfigProto()
config<span style="color:#f92672">.</span>gpu_options<span style="color:#f92672">.</span>allow_growth <span style="color:#f92672">=</span> True
session <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>v1<span style="color:#f92672">.</span>InteractiveSession(config<span style="color:#f92672">=</span>config)
</code></pre></div><p>Các pre-trained model phổ biến đã được tích hợp sẵn trong tensorflow. Ở đây ta khai báo lớp InceptionV3 để sử dụng InceptionNet pre-trained model.</p>
<p>Tiếp theo là chuẩn bị dữ liệu huấn luyện:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">data_gen</span>():
    training_datagen <span style="color:#f92672">=</span> ImageDataGenerator(
        rescale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>,
        rotation_range<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span>,
        width_shift_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>,
        height_shift_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>,
        shear_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>,
        horizontal_flip<span style="color:#f92672">=</span>True,
        fill_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;nearest&#39;</span>
    )
    validation_datagen <span style="color:#f92672">=</span> ImageDataGenerator(rescale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>)
    
    training_generator <span style="color:#f92672">=</span> training_datagen<span style="color:#f92672">.</span>flow_from_directory(
        <span style="color:#e6db74">&#39;horse-and-humand/train&#39;</span>,
        target_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">224</span>),
        batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>,
        class_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary&#39;</span>
    )
    
    validation_generator <span style="color:#f92672">=</span> validation_datagen<span style="color:#f92672">.</span>flow_from_directory(
        <span style="color:#e6db74">&#39;horse-and-humand/validation&#39;</span>,
        target_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">224</span>),
        batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>,
        class_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary&#39;</span>
    )
    
    <span style="color:#66d9ef">return</span> training_generator, validation_generator
</code></pre></div><p>Khai báo 2 hàm callback: EarlyStopping và ModelCheckpoint:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_callbacks</span>():
    callback_1 <span style="color:#f92672">=</span> ModelCheckpoint(
        <span style="color:#e6db74">&#39;horse-humand_model_checkpoint/weights-improvement-{epoch:02d}-{val_acc:.2f}.hdf5&#39;</span>,
        monitor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;val_acc&#39;</span>,
        save_best_only<span style="color:#f92672">=</span>True,
        save_weights_only<span style="color:#f92672">=</span>True,
        save_freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;epoch&#39;</span>,
        mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;auto&#39;</span>,
        verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
    )

    callback_2 <span style="color:#f92672">=</span> EarlyStopping(monitor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;val_acc&#39;</span>, patience<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)

    <span style="color:#66d9ef">return</span> [callback_1, callback_2]
</code></pre></div><p>Phần quan trọng nhất trong bài này là định nghĩa model, sử dụng kỹ thuật Transfer Learning:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_model</span>():
    <span style="color:#75715e"># Load pre-trained model</span>
    base_model <span style="color:#f92672">=</span> InceptionV3(
        input_shape<span style="color:#f92672">=</span>(<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">3</span>), <span style="color:#75715e"># Kích thước ảnh đầu vào</span>
        include_top<span style="color:#f92672">=</span>False, <span style="color:#75715e"># Loại bỏ các FC layers ở cuối</span>
        weights<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;imagenet&#39;</span> <span style="color:#75715e"># Sử dụng các weights được train trên tập imagenet</span>
    )
    <span style="color:#75715e"># Đóng băng các layers của pre-trained model, không cho chúng update</span>
    <span style="color:#66d9ef">for</span> layer <span style="color:#f92672">in</span> base_model<span style="color:#f92672">.</span>layers:
        layer<span style="color:#f92672">.</span>trainable <span style="color:#f92672">=</span> False
        
    <span style="color:#75715e"># Tạo head_model</span>
    head_model <span style="color:#f92672">=</span> base_model<span style="color:#f92672">.</span>output
    head_model <span style="color:#f92672">=</span> layers<span style="color:#f92672">.</span>Flatten()(head_model)
    head_model <span style="color:#f92672">=</span> layers<span style="color:#f92672">.</span>Dense(<span style="color:#ae81ff">1024</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>)(head_model)
    head_model <span style="color:#f92672">=</span> layers<span style="color:#f92672">.</span>Dropout(<span style="color:#ae81ff">0.2</span>)(head_model)
    head_model <span style="color:#f92672">=</span> layers<span style="color:#f92672">.</span>Dense(<span style="color:#ae81ff">1</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sigmoid&#39;</span>)(head_model)

    model <span style="color:#f92672">=</span> Model(inputs<span style="color:#f92672">=</span>base_model<span style="color:#f92672">.</span>input, outputs<span style="color:#f92672">=</span>head_model)
    model<span style="color:#f92672">.</span>compile(optimizer<span style="color:#f92672">=</span>RMSprop(lr<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>), loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary_crossentropy&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;acc&#39;</span>])
    
    <span style="color:#66d9ef">return</span> model
</code></pre></div><p>Model được tạo thành gồm 2 phần:</p>
<ul>
<li>base_model: chính là pre-trained model (<em>đã loại bỏ các FC layers ở cuối</em>).</li>
<li>head_model: là các FC layers được thêm vào làm nhiệm vụ phân loại dựa theo tập dữ liệu mới.</li>
</ul>
<p>Trong bài toán này, ta sử dụng pre-trained model của mạng InceptionNetV3 trên tập dữ liệu imagenet. Head_model bao gồm 2 FC layers xen kẽ DO layer ở giữa.</p>
<p>Hàm vẽ đồ thị:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_chart</span>(history):
    acc <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;acc&#39;</span>]
    val_acc <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;val_acc&#39;</span>]
    loss <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;loss&#39;</span>]
    val_loss <span style="color:#f92672">=</span> history<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;val_loss&#39;</span>]

    epochs <span style="color:#f92672">=</span> range(len(acc))
    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))

    plt<span style="color:#f92672">.</span>plot(epochs, acc, <span style="color:#e6db74">&#39;r&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Training Accuracy&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(epochs, val_acc, <span style="color:#e6db74">&#39;b&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Validation Accuracy&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(epochs, loss, <span style="color:#e6db74">&#39;g&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Training Loss&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(epochs, val_loss, <span style="color:#e6db74">&#39;y&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Validation Loss&#39;</span>)

    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Traing and Validation, Accuracy and Loss&#39;</span>)
    plt<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
    plt<span style="color:#f92672">.</span>show()
</code></pre></div><p>Gộp tất cả lại và tiến hành train model:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">model <span style="color:#f92672">=</span> create_model()
training_generator, validation_generator <span style="color:#f92672">=</span> data_gen()
callbacks <span style="color:#f92672">=</span> create_callbacks()

history <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(
    training_generator,
    epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>,
    callbacks<span style="color:#f92672">=</span>[callback_1, callback_2],
    validation_data<span style="color:#f92672">=</span>validation_generator,
    verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
)
</code></pre></div><p>Training output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Epoch <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.1342</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9786</span>
Epoch <span style="color:#ae81ff">00001</span>: val_acc improved <span style="color:#f92672">from</span> <span style="color:#f92672">-</span>inf to <span style="color:#ae81ff">0.91797</span>, saving model to horse<span style="color:#f92672">-</span>humand_model_checkpoint<span style="color:#f92672">/</span>weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">01</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.92</span><span style="color:#f92672">.</span>hdf5
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">12</span>s <span style="color:#ae81ff">180</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.1342</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9786</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.4456</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.9180</span>
Epoch <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.0992</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9708</span>
Epoch <span style="color:#ae81ff">00002</span>: val_acc did <span style="color:#f92672">not</span> improve <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.91797</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">12</span>s <span style="color:#ae81ff">189</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.0992</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9708</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.9824</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.8594</span>
Epoch <span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.0501</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9903</span>
Epoch <span style="color:#ae81ff">00003</span>: val_acc improved <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.91797</span> to <span style="color:#ae81ff">0.95312</span>, saving model to horse<span style="color:#f92672">-</span>humand_model_checkpoint<span style="color:#f92672">/</span>weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.95</span><span style="color:#f92672">.</span>hdf5
<span style="color:#f92672">............</span>
Epoch <span style="color:#ae81ff">8</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.1031</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9834</span>
Epoch <span style="color:#ae81ff">0000</span><span style="color:#ae81ff">8</span>: val_acc did <span style="color:#f92672">not</span> improve <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.99219</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">13</span>s <span style="color:#ae81ff">201</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.1031</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9834</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.5211</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.9219</span>
Epoch <span style="color:#ae81ff">9</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.0893</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9786</span>
Epoch <span style="color:#ae81ff">0000</span><span style="color:#ae81ff">9</span>: val_acc did <span style="color:#f92672">not</span> improve <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.99219</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">13</span>s <span style="color:#ae81ff">203</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.0893</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9786</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.5921</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.9180</span>
Epoch <span style="color:#ae81ff">10</span><span style="color:#f92672">/</span><span style="color:#ae81ff">30</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> ETA: <span style="color:#ae81ff">0</span>s <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.1015</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9815</span>
Epoch <span style="color:#ae81ff">00010</span>: val_acc did <span style="color:#f92672">not</span> improve <span style="color:#f92672">from</span> <span style="color:#ae81ff">0.99219</span>
<span style="color:#ae81ff">65</span><span style="color:#f92672">/</span><span style="color:#ae81ff">65</span> [<span style="color:#f92672">==============================</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">13</span>s <span style="color:#ae81ff">204</span>ms<span style="color:#f92672">/</span>step <span style="color:#f92672">-</span> loss: <span style="color:#ae81ff">0.1015</span> <span style="color:#f92672">-</span> acc: <span style="color:#ae81ff">0.9815</span> <span style="color:#f92672">-</span> val_loss: <span style="color:#ae81ff">0.4264</span> <span style="color:#f92672">-</span> val_acc: <span style="color:#ae81ff">0.9453</span>
</code></pre></div><p>Model dừng train sau 10 epochs, độ chính xác cao nhất đạt được trên tập validation là 94.53%, một kết quả khá cao với số lượng epochs &ldquo;khiêm tốn&rdquo; như vậy.</p>
<p>Quan sát thư mục <code>horse-humand_model_checkpoint</code> ta cũng thấy model được lưu tại một số điểm checkpoint. Model có độ chính xác cao nhất tại epoch thứ 3.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">01</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.92</span><span style="color:#f92672">.</span>hdf5
<span style="color:#960050;background-color:#1e0010">├──</span> weights<span style="color:#f92672">-</span>improvement<span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.95</span><span style="color:#f92672">.</span>hdf5
</code></pre></div><p>Kiểm tra quá trình huấn luyện bằng cách thể hiện giá trị loss và accuracy lên đồ thị:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plot_chart(history)
</code></pre></div>

<div style="text-align:center">
    <img style="height:auto" src="/images/post/32_transfer_learning.png">
</div>


<p>Mặc dù giá trị của val_loss dao động 1 chút nhưng acc, val_acc và loss đều khá lý tưởng, chứng tỏ sự hiệu quả của kỹ thuật Transfer Learning trong bài toàn này.</p>
<p>Source code của bài này, các bạn có thể tham khảo trên github cá nhân của mình tại <a href="https://github.com/tiensu/Computer_Vision/blob/master/Deep_Learning/Transfer_Learning.ipynb">đây</a>.</p>
<p>Các bài viết từ trước đến giờ đều chỉ phân loại 2 lớp. Đối với bài toán phân loại nhiều lớp thì sẽ như thế nào? Câu trả lời sẽ có ở bài tiếp theo . Mời các bạn đón đọc!</p>
<p><strong>Tham khảo</strong></p>
<ul>
<li><a href="https://www.coursera.org/professional-certificates/tensorflow-in-practice">Coursera</a></li>
<li><a href="https://machinelearningcoban.com/2017/07/02/tl/">MachineLearningCoban</a></li>
</ul>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://tiensu.github.io/"><img src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:0869644890"><i
                class="ti-mobile mr-3 text-primary"></i>0869644890</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Hanoi, Vietnam</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:tiensunguyen2103@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>tiensunguyen2103@gmail.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://www.facebook.com/tiensunguyen2103">Facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/">Linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/algorithm-optimization">Algorithm optimization</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/convolution-neural-network">Convolution neural network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-science">Data science</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/deep-learning">Deep learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ebook">Ebook</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ensemble-learning">Ensemble learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/image-classification">Image classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/machine-learning">Machine learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/model-deployment">Model deployment</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/neural-network">Neural network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/project-management">Project management</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/text-classification">Text classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/xgboost">Xgboost</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright © 2021 <a href="tiensu.github.io">SuNT</a>. All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://tiensu.github.io/index.json"
</script>

<!-- JS Plugins -->

<script src="https://tiensu.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://tiensu.github.io/plugins/slick/slick.min.js"></script>

<script src="https://tiensu.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/fuse.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/mark.js"></script>

<script src="https://tiensu.github.io/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://tiensu.github.io/js/script.min.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>