<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>SuNT&#39;s Blog | AI in Practical</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is meta description">
  <meta name="author" content="SuNT">
  <meta name="generator" content="Hugo 0.68.3" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/plugins/venobox/venobox.css ">
  
  <link rel="stylesheet" href="https://tiensu.github.io/css/override.css">
  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://tiensu.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://tiensu.github.io/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://tiensu.github.io/"><img class="img-fluid"
          src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/tiensunguyen2103"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://tiensu.github.io/"><img class="img-fluid"
            src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://tiensu.github.io/contact">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://tiensu.github.io//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/model-deployment"
          class="text-primary">Model deployment</a>
        
        <h2>Triển khai AI model sử dụng uWSGI và Nginx</h2>
        <div class="mb-3 post-meta">
          <span>By SuNT</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>30 December 2020</span>
          
        </div>
        
        <img src="https://tiensu.github.io/images/featured-post/35_uWSGI.png" class="img-fluid w-100 mb-4" alt="Triển khai AI model sử dụng uWSGI và Nginx">
        
        <div class="content mb-5">
          <p>Như đã giới thiệu trong bài trước, mặc dù Flask rất dễ để sử dụng nhưng nó không có đầy đủ chức năng để có thể áp dụng vào các sản phẩm trong thực tế. Đó là tính bảo mật, khả năng xử lý đồng thời nhiều kết nối, khả năng mở rộng và nâng cấp model, &hellip; Sử dụng kết hợp bộ ba Flask, uWSGI và Nginx chính là giải pháp hữu hiệu khắc phục những thiếu sót này. Trong bài viết này, chúng ta sẽ cùng tìm hiểu cách cài đặt, cấu hình và sử dụng bộ 3 kể trên để triển khai <code>Animal Classification model</code> dưới dạng server phục vụ các yêu cầu nhận dạng từ các clients.</p>
<p><strong>1. WSGI, uWSGI, và uwsgi là gì?</strong></p>
<p>Trước tiên cần hiểu rõ một số thuật ngữ mà ta sử dụng trong bài này.</p>
<ul>
<li>WSGI: Viết tắt của <code>Web Server Gateway Interface</code>, là một Interface giữa server và client, được viết bằng python. Hiểu một cách đơn giản, nó quy định các thức để client có thể kết nối và gửi nhận dữ liệu với server.</li>
<li>uWSGI: Là một server, sử dụng WSGI để giao tiếp với client (<em>hoặc sử dụng giao thức HTTP trong trường hợp client là web application</em>).</li>
<li>uwsgi: Là một giao thức ở tầng thấp hơn, cho phép các servers giao tiếp với nhau.</li>
</ul>
<p>Bạn có thể xem sơ đồ kiến trúc triển khai sử dụng uWSGI như hình bên dưới đây:</p>


<div style="text-align:center">
    <img style="height:auto" src="/images/post/35_uwsgi.png">
</div>


<p>Phần xử lý nhận diện của ta vẫn được gọi thông qua Flask. Phía trước Flask ta đặt uWSGI rồi đến web application (<em>client</em>).</p>
<p>Việc đặt uWSGI như vậy mang lại cho ta các lợi ích như sau:</p>
<ul>
<li>Quản lý tiến trình: Quản lý việc tạo và duy trì các tiến trình trong quá trình làm việc. Các tiến trình được đồng bộ với nhau trong cùng 1 môi trường và có khả năng scale-up để phục vụ cho nhiều users.</li>
<li>Cân bằng tải: Phân phối tải (<em>các requests</em>) đến các tiến trình khác nhau.</li>
<li>Giám sát: Giám sát hiệu năng và tài nguyên sử dụng.</li>
<li>Hạn chế tài nguyên: Cho phép chỉ định mức tối đa tài nguyên có thể sử dụng.</li>
</ul>
<p><strong>2. Nginx là gì và tại sao phải sử dụng nó?</strong></p>
<p>Nginx là một webserver với các đặc tính:</p>
<ul>
<li>High performance: Hiệu năng cao</li>
<li>Highly scalable: Khả năng mở rộng cao</li>
<li>Highly available: Tính sẵn sàng cao</li>
</ul>
<p>Nó hoạt động giống như một bộ cân bằng tải, một <a href="https://vi.wikipedia.org/wiki/Reverse_proxy">reverse proxy</a> cùng với cơ chế caching, cơ chế mã hóa và bảo mật trên các bản tin giao tiếp giữa client và server.  Nginx được cho là có thể phục vụ hơn 10,000 kết nối đồng thời.</p>
<p>Nginx được sử dụng khá phổ biến trong các công ty công nghệ lớn, trong nhiều sản phẩm, ứng dụng cần phục vụ số lượng lớn người dùng đồng thời.</p>
<p>Xét về kiến trúc tổng thể, nó thường được sử dụng cùng với uWSGI, đứng trước uWSGI như trong hình sau:</p>


<div style="text-align:center">
    <img style="height:auto" src="/images/post/35_nginx.png">
</div>


<p>Mục đích của việc sử dụng đồng thời cả uWSGI và Nginx là để tận dụng những ưu điểm của cả 2. Tất nhiên điều này là không bắt buộc nếu ứng dụng của chúng ta ở mức đơn giản, không cần phải phục vụ số lượng users đồng thời quá lớn. Nhưng dù sao vẫn nên sử dụng kiến trúc này để có thể dễ dàng mở rộng ứng dụng về sau.</p>
<p><strong>3. Chuẩn bị Flask server</strong></p>
<p>Ta vẫn cần có Flask làm server trực tiếp xử lý request từ client. Có thể hiểu Flask server ở đây là <code>endpoint</code> cũng được. Mình sẽ sử dụng lại file <code>server.py</code> ở bài trước, nhưng đã bỏ đi phần phục vụ web client.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> cv2
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> tensorflow <span style="color:#f92672">as</span> tf
<span style="color:#f92672">from</span> flask_cors <span style="color:#f92672">import</span> CORS
<span style="color:#f92672">from</span> tensorflow.keras.models <span style="color:#f92672">import</span> load_model
<span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, request, render_template, make_response, jsonify

config <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>v1<span style="color:#f92672">.</span>ConfigProto()
config<span style="color:#f92672">.</span>gpu_options<span style="color:#f92672">.</span>allow_growth <span style="color:#f92672">=</span> True
session <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>v1<span style="color:#f92672">.</span>InteractiveSession(config<span style="color:#f92672">=</span>config)

app <span style="color:#f92672">=</span> Flask(__name__)
CORS(app)

image_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>
image_height <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>
classes <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;cat&#39;</span>, <span style="color:#e6db74">&#39;dog&#39;</span>, <span style="color:#e6db74">&#39;pandas&#39;</span>]
APP_ROOT_2 <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;APP_ROOT&#39;</span>, <span style="color:#e6db74">&#39;/infer&#39;</span>)
model <span style="color:#f92672">=</span> load_model(<span style="color:#e6db74">&#39;animal_model_classification.h5&#39;</span>)

        
<span style="color:#a6e22e">@app.route</span>(APP_ROOT_2, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;POST&#34;</span>]) 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">infer</span>(): 
	data <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>json 
	img_path <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;img_path&#39;</span>] 
	<span style="color:#66d9ef">return</span> classify_animal(img_path)
        
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">classify_animal</span>(img_path):
    <span style="color:#75715e"># read image</span>
    image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(img_path)
    image <span style="color:#f92672">=</span> image<span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>
    image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(image, (image_width,image_height))   
    image <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>reshape(image, [<span style="color:#ae81ff">1</span>,image_width,image_height,<span style="color:#ae81ff">3</span>])

    <span style="color:#75715e"># pass the image through the network to obtain our predictions</span>
    preds <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(image)
    label <span style="color:#f92672">=</span> classes[np<span style="color:#f92672">.</span>argmax(preds)]

    <span style="color:#66d9ef">return</span> label
  
<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    app<span style="color:#f92672">.</span>run()
</code></pre></div><p><strong>4. Cài đặt và cấu hình uWSGI</strong></p>
<p>Để cài đặt uWSGI, sử dụng lệnh sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> pip install uwsgi
</code></pre></div><p>Kiểm tra cài đặt bằng cách chạy câu lệnh sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> uwsgi <span style="color:#f92672">--</span>http <span style="color:#ae81ff">0.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.0</span>:<span style="color:#ae81ff">8080</span>  <span style="color:#f92672">--</span>wsgi<span style="color:#f92672">-</span>file server<span style="color:#f92672">.</span>py <span style="color:#f92672">--</span>callable app
</code></pre></div><p>Nếu output như sau thì tức là viêc cài đặt thành công:</p>


<div style="text-align:center">
    <img style="height:auto" src="/images/post/35_uwsgi_1.png">
</div>


<p>Câu lệnh trên có ý nghĩa là chạy một server tại địa chỉ 0.0.0.0, port 8080, sử dụng ứng dụng đặt trong file server.py.</p>
<p>uWSGI có rất nhiều tùy chọn cấu hình. Do đó, để thuận tiện, ta thường tạo một file cấu hình, tên là <code>app.ini</code> như sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[uwsgi] 
  
http <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.0</span>:<span style="color:#ae81ff">8080</span> <span style="color:#75715e"># địa chỉ server</span>
socket <span style="color:#f92672">=</span> service<span style="color:#f92672">.</span>sock <span style="color:#75715e"># socket giao tiếp với Nginx</span>
chmod<span style="color:#f92672">-</span>socket <span style="color:#f92672">=</span> <span style="color:#ae81ff">660</span> <span style="color:#75715e"># cấp quyền truy câp  socket</span>
wsgi<span style="color:#f92672">-</span>file <span style="color:#f92672">=</span> server<span style="color:#f92672">.</span>py <span style="color:#75715e"># file chứa code xử lý yêu cầu từ client</span>
callable <span style="color:#f92672">=</span> app <span style="color:#75715e"># function được gọi khi tạo uWSGI</span>
die<span style="color:#f92672">-</span>on<span style="color:#f92672">-</span>term <span style="color:#f92672">=</span> true <span style="color:#75715e"># cho phép kill server từ terminal</span>
processes <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#75715e"># số lượng process</span>
threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># số lượng thread</span>
chdir <span style="color:#f92672">=</span> <span style="color:#f92672">/</span>media<span style="color:#f92672">/</span>sunt<span style="color:#f92672">/</span>DATA<span style="color:#f92672">/</span>GITHUB<span style="color:#f92672">/</span>Model_Deployment<span style="color:#f92672">/</span>uWSGI<span style="color:#f92672">/</span> <span style="color:#75715e"># thư mục dự án</span>
virtualenv <span style="color:#f92672">=</span> <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>sunt<span style="color:#f92672">/</span>anaconda3<span style="color:#f92672">/</span>envs<span style="color:#f92672">/</span>tf2<span style="color:#f92672">/</span> <span style="color:#75715e"># môi trường ảo (nếu có)</span>
master <span style="color:#f92672">=</span> false 
vacuum <span style="color:#f92672">=</span> truemodule <span style="color:#75715e"># định kỳ xóa những file ko cần thiết được sinh ra</span>
</code></pre></div><p>Để chạy uWSGI, dùng lệnh:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> uwsgi app<span style="color:#f92672">.</span>ini
</code></pre></div><p>Nếu thành công, output trên terminal sẽ như sau:</p>


<div style="text-align:center">
    <img style="height:auto" src="/images/post/35_uwsgi_2.png">
</div>


<p><strong>5. Cài đặt và cấu hình Nginx</strong></p>
<p>Để cài đặt Nginx, sử dụng lệnh sau:</p>
<pre><code>$ sudo apt-get install nginx
</code></pre><p>Tiếp theo, tạo một file cấu hình đặt trong thư mục <code>/etc/nginx/sites-available</code>, tên là <code>service.conf</code>, với nội dụng như sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">server {
        listen <span style="color:#ae81ff">80</span>;
        server_name <span style="color:#ae81ff">0.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.0</span>;

        location <span style="color:#f92672">/</span> {
            include uwsgi_params;
            uwsgi_pass unix:<span style="color:#f92672">/</span>media<span style="color:#f92672">/</span>sunt<span style="color:#f92672">/</span>DATA<span style="color:#f92672">/</span>GITHUB<span style="color:#f92672">/</span>Model_Deployment<span style="color:#f92672">/</span>uWSGI<span style="color:#f92672">/</span>service<span style="color:#f92672">.</span>sock;
        }
}
</code></pre></div><p>Theo cấu hình này, Nginx sẽ lắng nghe trên cổng 80 (<em>mặc định</em>) cho tất cả các yêu cầu đến server đặt tại địa chỉ 0.0.0.0. Các yêu cầu sau đó được chuyển đến uWSGI server thông qua socket service.sock (<em>sử dụng giao thức uwsgi</em>).</p>
<p>Tiếp theo, để áp dụng các cấu hình trên cho Nginx, ta cần trỏ liên kết của chúng tới thư mục <code>sites-enabled</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> sudo ln <span style="color:#f92672">-</span>s <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>sites<span style="color:#f92672">-</span>available<span style="color:#f92672">/</span>service<span style="color:#f92672">.</span>config <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>sites<span style="color:#f92672">-</span>enabled
</code></pre></div><p>Kiểm tra lại xem các cấu hình đã đúng hay chưa?:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> sudo nginx <span style="color:#f92672">-</span>t 
</code></pre></div><p>Nếu mọi thứ OK, sẽ có output như sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nginx: the configuration file <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>nginx<span style="color:#f92672">.</span>conf syntax <span style="color:#f92672">is</span> ok
nginx: configuration file <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>nginx<span style="color:#f92672">.</span>conf test <span style="color:#f92672">is</span> successful
</code></pre></div><p>Cuối cùng, restart lại Nginx server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> sudo systemctl status nginx
</code></pre></div>

<div style="text-align:center">
    <img style="height:auto" src="/images/post/35_nginx_2.png">
</div>


<p><strong>6. Tạo client và kiểm tra kết quả</strong></p>
<p>Sử dụng lại client viết bằng python như ở bài trước:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> requests 
<span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> Image 
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np 
ENDPOINT_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://0.0.0.0:8080/infer2&#39;</span>
 
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">infer</span>():
    data <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;img_path&#39;</span>: <span style="color:#e6db74">&#39;dog.1.jpg&#39;</span> }
    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(ENDPOINT_URL, json <span style="color:#f92672">=</span> data)
    response<span style="color:#f92672">.</span>raise_for_status()
    <span style="color:#66d9ef">print</span>(response<span style="color:#f92672">.</span>content) 
  
<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#34;__main__&#34;</span>: 
    infer() 
</code></pre></div><p>Để kiểm tra hoạt động của client và server, đầu tiên khởi chạy uWSGI (<em>như phần 4.</em>), sau đó chạy client:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> python client<span style="color:#f92672">.</span>py
</code></pre></div><p>Nếu nhận được kết quả trả vê từ server tức là hệ thống đã hoạt động chính xác:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">b<span style="color:#e6db74">`dog`</span>
</code></pre></div><p><strong>7. Kết luận</strong></p>
<p>Như vậy là chúng ta đã cùng nhau triển khai thành công DL model sử dụng Nginx, uWSGI và Flask. Nginx thì mặc định được chạy dưới dạng service sau khi cài đặt xong, còn uWSGI thì không. Ta nên cấu hình uWSGI để nó cũng chạy dưới dạng service cho thuận tiện sử dụng. Hi vọng qua bài này, các bạn đã hiểu rõ hơn về cách thức triển khai một AI model trong các sản phẩm thực tế, đáp ứng số lượng lớn user sử dụng đồng thời.</p>
<p>Toàn bộ source code của backend và front-end trong bài này, các bạn có thể tham khảo trên github cá nhân của mình tại <a href="https://github.com/tiensu/Model_Deployment/tree/master/uWSGI">đây</a>. Vì model <code>animal_model_classification.h5</code> có dung lượng khá lớn (<em>&gt; 1.5GB</em>) nên mình không upload lên github được. Các bạn hãy sử dụng model của chính mình để thực hành nhé!</p>
<p>Bài viết tiếp theo, chúng ta sẽ đi nâng cao hơn 1 chút nữa, đó là đóng gói tất cả những phần đã làm hôm nay vào một cái gọi là docker. Docker là gì, và tại sao lại nên dùng nó? Tất cả sẽ được giải đáp trong bài viết đó. Mời các bạn đón đọc!</p>
<p><strong>8. Tham khảo</strong></p>
<ul>
<li><a href="https://www.nginx.com/">Nginx</a></li>
<li><a href="https://uwsgi-docs.readthedocs.io/en/latest/">uWSGI</a></li>
<li><a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a></li>
<li><a href="https://theaisummer.com/uwsgi-nginx/">AI Summer</a></li>
</ul>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://tiensu.github.io/"><img src="https://tiensu.github.io/images/logo3.jpg" alt="SuNT&#39;s Blog | AI in Practical" style="height: auto"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:0869644890"><i
                class="ti-mobile mr-3 text-primary"></i>0869644890</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Hanoi, Vietnam</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:tiensunguyen2103@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>tiensunguyen2103@gmail.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://www.facebook.com/tiensunguyen2103">Facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/su-nguyen-tien-aws%C2%AE-5ba74ba6/">Linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/algorithm-optimization">Algorithm Optimization</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/convolution-neural-network">Convolution Neural Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-driff">Data driff</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/data-science">Data Science</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/deep-learning">Deep Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/docker">Docker</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ebook">Ebook</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ensemble-learning">Ensemble Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/image-classification">Image classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/kubernetes">Kubernetes</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/machine-learning">Machine Learning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/model-deployment">Model deployment</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/neural-network">Neural Network</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/project-management">Project Management</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/text-classification">Text Classification</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/xgboost">Xgboost</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://tiensu.github.io/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright © 2021 <a href="tiensu.github.io">SuNT</a>. All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://tiensu.github.io/index.json"
</script>

<!-- JS Plugins -->

<script src="https://tiensu.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://tiensu.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://tiensu.github.io/plugins/slick/slick.min.js"></script>

<script src="https://tiensu.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/fuse.min.js"></script>

<script src="https://tiensu.github.io/plugins/search/mark.js"></script>

<script src="https://tiensu.github.io/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://tiensu.github.io/js/script.min.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>