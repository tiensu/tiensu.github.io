<!DOCTYPE html>
<html lang="en-us">
    <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="format-detection" content="telephone=no" />

  <title>
    XGBoost - Bài 5: Trực quan hóa XGBoost model | ML in Practical
  </title>

  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#ffffff" />

  
  <link
    rel="stylesheet"
    href="https://unpkg.com/modern-normalize@0.6.0/modern-normalize.css"
  />

  
  
  
  
  <link rel="stylesheet" href="https://tiensu.github.io/style.min.f7761d111b74dd5c07f0111decee92938c12abc42e0fd319e1a07483e248b54e.css" integrity="sha256-93YdERt03VwH8BEd7O6Sk4wSq8QuD9MZ4aB0g&#43;JItU4=" />

  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-180180568-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>

  
</head>

    <body>
        <header id="header">
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-180180568-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>

  <div class="header_container">
    <h1 class="sitetitle">
      <a href="https://tiensu.github.io/" title="ML in Practical">ML in Practical</a>
    </h1>
    <nav class="navbar">
      <ul>
        <li><a href="https://tiensu.github.io/">Home</a></li>
        
          <li>
            <a href="/about/">
              
              <span>About</span>
            </a>
          </li>
        
          <li>
            <a href="/tags/">
              
              <span>Tags</span>
            </a>
          </li>
        
          <li>
            <a href="/archives/">
              
              <span>Archives</span>
            </a>
          </li>
        
        <li class="hide-sm"><a href="https://tiensu.github.io/index.xml" type="application/rss+xml">RSS</a></li>
      </ul>
    </nav>
  </div>
</header>

        
<section id="main">
  <article class="post content">
    <h2 class="title">XGBoost - Bài 5: Trực quan hóa XGBoost model</h2>
    <div class="post_content">
      <p>Ta đã biết, XGBoost thực chất là tập hợp gồm nhiều <code>decision tree</code>. Việc thể hiện mỗi <code>decision tree</code> đó trên đồ thì sẽ giúp chúng ta hiểu sâu sắc hơn quá trình <code>boosting</code> khi đưa vào một tập dữ liệu. Trong bài này, hãy cùng tìm hiểu cách thức thể hiện đó từ một XGBoost model đã được train.</p>
<p><strong>1. Vẽ một <code>decision tree</code> đơn lẻ</strong></p>
<p><code>XGBoost Python API</code> cung cấp một hàm cho việc vẽ các <code>decision tree</code> của một XGBoost model đã train, đó là <code>plot_tree()</code>. Hàm này nhận một tham số đầu tiên chính là model cần thể hiện.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">plot_tree</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div><p>Đồ thị vẽ ra bởi hàm này có thể được lưu dưới dạng file hoặc hiển thị trên màn hình bằng cách sử dụng hàm <code>pyplot.show()</code> của thư viện <code>matplotlib</code>. Yêu cầu là thư viện <a href="http://www.graphviz.or">graphviz</a> đã được cài đặt.</p>
<p>Để minh họa cho việc này, hãy cùng tạo một một XGBoost model và train nó trên tập dữ liệu <a href="https://archive.ics.uci.edu/ml/datasets/Pima+Indians+Diabet">Pima Indians onset of diabetes dataset</a>. Code đầy đủ như bên dưới:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># plot decision tree</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">loadtxt</span>
<span class="kn">from</span> <span class="nn">XGBoost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">XGBoost</span> <span class="kn">import</span> <span class="n">plot_tree</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="c1"># load data</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;pima-indians-diabetes.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&#34;,&#34;</span><span class="p">)</span>
<span class="c1"># split data into X and y</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]</span>
<span class="c1"># fit model on training data</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c1"># plot single tree</span>
<span class="n">plot_tree</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><p>Đoạn code bên trên sẽ tạo ra một đồ thị của <code>decision tree</code> đầu tiên trong model (<em>index 0</em>). Các <code>feature</code> và <code>feature value</code> được thể hiện trên đồ thị.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<figure>
    <img src="/plot_XGBoost_1.png" width="710"/> 
</figure>

<p>Một vài quan sát:</p>
<ul>
<li>Các <code>features</code> được đặt tên tự động từ <code>f1</code> đến <code>f5</code> tương ứng với các <code>feature indices</code> trong dataset.</li>
<li>Trong mỗi node, hai hướng trái phải được phân biệt bằng màu sắc. Bên trái là màu xanh, trong khi bên phải là màu đỏ.</li>
</ul>
<p><strong>2. Một số tùy chọn</strong></p>
<p>Ngoài tham số model cần vẽ là bắt buộc, hàm <code>plot_tree()</code> còn nhận vào một vài tham số tùy chọn khác:</p>
<ul>
<li><code>num_trees</code>: Chỉ số <code>tree</code> muốn vẽ. Giá trị mặc định là 0. Ví dụ:</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">plot_tree</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">num_trees</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div><p>sẽ vẽ <code>boosted tree</code> thứ 5.</p>
<ul>
<li><code>rankdir</code>: Hướng của đồ thị. Ví dụ: <em>LR</em> là <em>left-to-right</em>. Mặc định là <em>UT</em> - <em>top-to-bottom</em>.</li>
</ul>
<p>Ví dụ:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">plot_tree</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">num_trees</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>
</code></pre></div><p>sẽ cho kết quả như sau:
<figure>
    <img src="/plot_XGBoost_2.png" width="710"/> 
</figure>
</p>
<p><strong>3. Kết luận</strong></p>
<p>Trong bài này, chúng ta đã tìm hiểu cách vẽ các <code>decision tree</code> của một XGBoost model đã train. Đây là cách rất hay giúp chúng ta có cái nhiều sâu hơn vào bên trong của model, hiểu rõ hơn cách thức mà model hoạt động.</p>
<p>Trong bài tiếp theo, chúng ta sẽ tìm hiểu cách lưu lại XGBoost model để train và sử dụng model đã lưu để dự đoán trên một mẫu data mới.</p>
<p><em>Toàn bộ source code của bài này các bạn có thể tham khảo trên github cá nhân của mình tại <a href="https://github.com/tiensu/XGBoost-algorithm/tree/master/visualize_decision_tree">github.</a></em></p>
<p>Bài viết có tham khảo tại <a href="https://machinelearningmastery.com/XGBoost-with-python/">tham khảo</a></p>

    </div>
    <div class="info post_meta">
      <time datetime=2020-09-21T00:00:00Z class="date">Monday, September 21, 2020</time>
      
        <ul class="tags">
        
          <li> <a href="https://tiensu.github.io/tags/ai">AI</a> </li>
        
          <li> <a href="https://tiensu.github.io/tags/ml">ML</a> </li>
        
          <li> <a href="https://tiensu.github.io/tags/xgboost">XGBoost</a> </li>
        
        </ul>
      
      
    </div>
    <div class="clearfix"></div>
  </article>
  
    <div class="other_posts">
      
      <a href="https://tiensu.github.io/posts/xgboost/evaluate-xgbosst-models/" class="prev">XGBoost - Bài 4: Đánh giá hiệu năng của XGBoost model</a>
      
      
      <a href="https://tiensu.github.io/posts/xgboost/save-load-xgboost-model/" class="next">Bài 6: Lưu và sử dụng XGBoost model</a>
      
    </div>
    <aside id="comments">
</aside>

  
</section>

        <a id="back_to_top" title="Go To Top" href="#">
  <span>
    <svg viewBox="0 0 24 24">
      <path fill="none" d="M0 0h24v24H0z"></path>
      <path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"></path>
    </svg>
  </span>
</a>

        <footer id="footer">
  <p>
    <span>&copy; 2020 <a href="https://tiensu.github.io/" title="ML in Practical">ML in Practical</a> </span>
    <span>Built with <a rel="nofollow" target="_blank" href="https://gohugo.io">Hugo</a></span>
    <span>Theme by <a rel="nofollow" target="_blank" href="https://github.com/wayjam/hugo-theme-mixedpaper">WayJam</a></span>
  </p>
  <script src="https://tiensu.github.io/js/main.min.8b182175f5874aeed0acc0979345c98d4bde22208ec4f36cc1d6e3102acb4b10.js" integrity="sha256-ixghdfWHSu7QrMCXk0XJjUveIiCOxPNswdbjECrLSxA=" crossorigin="anonymous" async></script>
</footer>

    </body>
</html>
